{"version":3,"sources":["PersistedFragment.ts"],"names":[],"mappings":"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","file":"PersistedFragment.js","sourcesContent":["import { Fragment } from \"./Fragment\";\nimport { ModelDecorator } from \"./ModelDecorator\";\nimport { ModelFactory } from \"./ModelFactory\";\nimport {\n\tDigestedObjectSchema,\n\tObjectSchemaUtils,\n} from \"./ObjectSchema\";\nimport { PersistedDocument } from \"./PersistedDocument\";\nimport { PersistedResource } from \"./PersistedResource\";\nimport { URI } from \"./RDF/URI\";\nimport {\n\taddTypeInResource,\n\thasTypeInResource,\n\tremoveTypeInResource,\n} from \"./Resource\";\nimport { isObject } from \"./Utils\";\n\nexport interface PersistedFragment extends PersistedResource, Fragment {\n\t_document:PersistedDocument;\n\n\taddType( type:string ):void;\n\n\thasType( type:string ):boolean;\n\n\tremoveType( type:string ):void;\n}\n\n\nexport interface PersistedFragmentFactory extends ModelFactory<PersistedFragment>, ModelDecorator<PersistedFragment> {\n\tisDecorated( object:object ):object is PersistedFragment;\n\n\tis( object:object ):object is PersistedFragment;\n\n\n\tdecorate<T extends object>( object:T ):T & PersistedFragment;\n\n\tcreate( document:PersistedDocument, id?:string ):PersistedFragment;\n\n\tcreateFrom<T extends object>( object:T, document:PersistedDocument, id?:string ):T & PersistedFragment;\n}\n\n\nfunction resolveURI( fragment:PersistedFragment, uri:string ):string {\n\tif( URI.isAbsolute( uri ) ) return uri;\n\n\tconst schema:DigestedObjectSchema = fragment._document._documents.getGeneralSchema();\n\treturn ObjectSchemaUtils.resolveURI( uri, schema, { vocab: true } );\n}\n\nfunction addTypeInPersistedFragment( this:PersistedFragment, type:string ):void {\n\ttype = resolveURI( this, type );\n\treturn addTypeInResource.call( this, type );\n}\n\nfunction hasTypeInPersistedFragment( this:PersistedFragment, type:string ):void {\n\ttype = resolveURI( this, type );\n\treturn hasTypeInResource.call( this, type );\n}\n\nfunction removeTypeInPersistedFragment( this:PersistedFragment, type:string ):void {\n\ttype = resolveURI( this, type );\n\treturn removeTypeInResource.call( this, type );\n}\n\nexport const PersistedFragment:PersistedFragmentFactory = {\n\tisDecorated( object:object ):object is PersistedFragment {\n\t\treturn isObject( object ) &&\n\t\t\tobject[ \"addType\" ] === addTypeInPersistedFragment &&\n\t\t\tobject[ \"hasType\" ] === hasTypeInPersistedFragment &&\n\t\t\tobject[ \"removeType\" ] === removeTypeInPersistedFragment\n\t\t\t;\n\t},\n\n\tis( object:object ):object is PersistedFragment {\n\t\treturn Fragment.is( object ) &&\n\t\t\tPersistedResource.isDecorated( object ) &&\n\t\t\tPersistedFragment.isDecorated( object )\n\t\t\t;\n\t},\n\n\n\tdecorate<T extends object>( object:T ):T & PersistedFragment {\n\t\tif( PersistedFragment.isDecorated( object ) ) return object;\n\n\t\tFragment.decorate( object );\n\t\tPersistedResource.decorate( object );\n\n\t\tconst fragment:T & PersistedFragment = object as T & PersistedFragment;\n\t\tObject.defineProperties( object, {\n\t\t\t\"addType\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: addTypeInPersistedFragment,\n\t\t\t},\n\t\t\t\"hasType\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasTypeInPersistedFragment,\n\t\t\t},\n\t\t\t\"removeType\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: removeTypeInPersistedFragment,\n\t\t\t},\n\t\t} );\n\n\t\treturn fragment;\n\t},\n\n\tcreate( document:PersistedDocument, id?:string ):PersistedFragment {\n\t\treturn PersistedFragment.createFrom( {}, document, id );\n\t},\n\n\tcreateFrom<T extends object>( object:T, document:PersistedDocument, id?:string ):T & PersistedFragment {\n\t\tconst fragment:T & PersistedFragment = PersistedFragment.decorate( object );\n\n\t\tfragment._document = document;\n\t\tif( id ) fragment.id = id;\n\n\t\treturn fragment;\n\t},\n\n};\n"]}