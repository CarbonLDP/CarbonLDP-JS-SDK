{"version":3,"sources":["PersistedProtectedDocument.ts"],"names":[],"mappings":";;;;;;;;;AAAA,kCAAiC;AAGjC,wCAAiD;AAIjD,yDAAwD;AAGxD,6CAAiC;AACjC,wCAAuC;AAiB1B,QAAA,0BAA0B,GAAqC;IAC3E,WAAW,EAAX,UAAa,MAAa;QACzB,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAE,MAAM,CAAE;eAC3B,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,QAAQ,CAAE,CACvC;IACH,CAAC;IAED,EAAE,EAAF,UAAI,MAAa;QAChB,MAAM,CAAC,kCAA0B,CAAC,WAAW,CAAE,MAAM,CAAE;eACnD,qCAAiB,CAAC,EAAE,CAAE,MAAM,CAAE,CAChC;IACH,CAAC;IAED,QAAQ,EAAR,UAA4B,MAAQ,EAAE,SAAmB;QACxD,EAAE,CAAA,CAAE,kCAA0B,CAAC,WAAW,CAAE,MAAM,CAAG,CAAC;YAAC,MAAM,CAAC,MAAM,CAAC;QAErE,qCAAiB,CAAC,QAAQ,CAAE,MAAM,EAAE,SAAS,CAAE,CAAC;QAEhD,IAAM,0BAA0B,GAAkC,MAAwC,CAAC;QAC3G,MAAM,CAAC,gBAAgB,CAAE,0BAA0B,EAAE;YACpD,QAAQ,EAAE;gBACT,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,MAAM;aACb;SACD,CAAE,CAAC;QAEJ,MAAM,CAAC,0BAA0B,CAAC;IACnC,CAAC;CAED,CAAC;AAMF,gBAAkD,cAA8B;IAAhF,iBAkBC;IAjBA,IAAI,UAA2B,CAAC;IAChC,EAAE,CAAA,CAAE,IAAI,CAAC,UAAU,EAAG,CAAC,CAAC,CAAC;QACxB,UAAU,GAAG,OAAO,CAAC,OAAO,CAAE,IAAI,CAAC,iBAAiB,CAAE,CAAC;IACxD,CAAC;IAAC,IAAI,CAAC,CAAC;QACP,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAa,iCAC5C,IAAI,CAAC,EAAE,WAAQ,OAAE,CAAC,iBAAiB,mBACtC,CAAE,CAAC,IAAI,CAAE,UAAE,EAAwD;gBAAtD,eAAO;YACrB,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAE,CAAC,CAAE,CAAC,GAAG,CAAC;QAClC,CAAC,CAAE,CAAC;IACL,CAAC;IAED,MAAM,CAAC,UAAU,CAAC,IAAI,CAAE,UAAE,GAAW;QACpC,MAAM,CAAC,KAAI,CAAC,UAAU,CAAC,GAAG,CAAE,GAAG,CAAC,EAAE,EAAE,cAAc,CAAE,CAAC;IACtD,CAAC,CAAE,CAAC,IAAI,CAA8B,UAAE,EAA4C;YAA1C,WAAG,EAAE,gBAAQ;QACtD,EAAE,CAAA,CAAE,CAAE,GAAG,CAAC,OAAO,CAAE,SAAG,CAAC,IAAI,CAAG,CAAC;YAAC,MAAM,IAAI,yBAAgB,CAAE,sCAAqC,SAAG,CAAC,IAAI,aAAW,EAAE,QAAQ,CAAE,CAAC;QACjI,MAAM,CAAC,CAAE,GAAG,EAAE,QAAQ,CAAE,CAAC;IAC1B,CAAC,CAAE,CAAC;AACL,CAAC;AAED,kBAAe,kCAA0B,CAAC","file":"PersistedProtectedDocument.js","sourcesContent":["import { ACL } from \"./Auth/ACL\";\nimport { PersistedACL } from \"./Auth/PersistedACL\";\nimport { Documents } from \"./Documents\";\nimport { BadResponseError } from \"./HTTP/Errors\";\nimport { RequestOptions } from \"./HTTP/Request\";\nimport { Response } from \"./HTTP/Response\";\nimport { ModelDecorator } from \"./ModelDecorator\";\nimport { PersistedDocument } from \"./PersistedDocument\";\nimport { Pointer } from \"./Pointer\";\nimport { SPARQLSelectResults } from \"./SPARQL/SelectResults\";\nimport * as Utils from \"./Utils\";\nimport { CS } from \"./Vocabularies/CS\";\n\nexport interface PersistedProtectedDocument extends PersistedDocument {\n\taccessControlList?:Pointer;\n\n\tgetACL( requestOptions?:RequestOptions ):Promise<[ PersistedACL, Response ]>;\n}\n\n\nexport interface PersistedProtectedDocumentFactory extends ModelDecorator<PersistedProtectedDocument> {\n\tisDecorated( object:object ):object is PersistedProtectedDocument;\n\n\tis( object:object ):object is PersistedProtectedDocument;\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & PersistedProtectedDocument;\n}\n\nexport const PersistedProtectedDocument:PersistedProtectedDocumentFactory = {\n\tisDecorated( object:object ):object is PersistedProtectedDocument {\n\t\treturn Utils.isObject( object )\n\t\t\t&& Utils.hasFunction( object, \"getACL\" )\n\t\t\t;\n\t},\n\n\tis( object:object ):object is PersistedProtectedDocument {\n\t\treturn PersistedProtectedDocument.isDecorated( object )\n\t\t\t&& PersistedDocument.is( object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & PersistedProtectedDocument {\n\t\tif( PersistedProtectedDocument.isDecorated( object ) ) return object;\n\n\t\tPersistedDocument.decorate( object, documents );\n\n\t\tconst persistedProtectedDocument:T & PersistedProtectedDocument = object as T & PersistedProtectedDocument;\n\t\tObject.defineProperties( persistedProtectedDocument, {\n\t\t\t\"getACL\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getACL,\n\t\t\t},\n\t\t} );\n\n\t\treturn persistedProtectedDocument;\n\t},\n\n};\n\ninterface ACLResult {\n\tacl:Pointer;\n}\n\nfunction getACL( this:PersistedProtectedDocument, requestOptions?:RequestOptions ):Promise<[ PersistedACL, Response ]> {\n\tlet aclPromise:Promise<Pointer>;\n\tif( this.isResolved() ) {\n\t\taclPromise = Promise.resolve( this.accessControlList );\n\t} else {\n\t\taclPromise = this.executeSELECTQuery<ACLResult>( `SELECT ?acl WHERE {\n\t\t\t<${ this.id }> <${ CS.accessControlList }> ?acl.\n\t\t}` ).then( ( [ results ]:[ SPARQLSelectResults<ACLResult>, Response ] ) => {\n\t\t\treturn results.bindings[ 0 ].acl;\n\t\t} );\n\t}\n\n\treturn aclPromise.then( ( acl:Pointer ) => {\n\t\treturn this._documents.get( acl.id, requestOptions );\n\t} ).then<[ PersistedACL, Response ]>( ( [ acl, response ]:[ PersistedACL, Response ] ) => {\n\t\tif( ! acl.hasType( ACL.TYPE ) ) throw new BadResponseError( `The response does not contains a ${ ACL.TYPE } object.`, response );\n\t\treturn [ acl, response ];\n\t} );\n}\n\nexport default PersistedProtectedDocument;\n"]}