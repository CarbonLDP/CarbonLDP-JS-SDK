{"version":3,"sources":["PersistedDocument.ts"],"names":[],"mappings":";;;;;IA2BA;QACC,OAAO;QACP,MAAM,CAAC,IAAI,CAAC;IACb,CAAC;IAED;QACC,OAAO;QACP,MAAM,CAAC,IAAI,CAAC;IACb,CAAC;IACD;QAAA,iBAIC;QAHA,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAE,IAAI,CAAE,CAAC,IAAI,CAAE,UAAE,QAA4B;YACvE,MAAM,CAAC,CAAE,KAAI,EAAE,QAAQ,CAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;IACJ,CAAC;IACD;QACC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;IACvC,CAAC;IAED,4BAA6B,QAAe,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QACrF,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAE,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,cAAc,CAAE,CAAC;IAChF,CAAC;IAED,yBAA0B,QAAe,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QAClF,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,eAAe,CAAE,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,cAAc,CAAE,CAAC;IAC7E,CAAC;IAED,+BAAgC,WAAkB,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QAC3F,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAE,IAAI,CAAC,EAAE,EAAE,WAAW,EAAE,cAAc,CAAE,CAAC;IACtF,CAAC;IAED,4BAA6B,WAAkB,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QACxF,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAE,IAAI,CAAC,EAAE,EAAE,WAAW,EAAE,cAAc,CAAE,CAAC;IACnF,CAAC;IAED,kCAAmC,cAAqB,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QACjG,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,wBAAwB,CAAE,IAAI,CAAC,EAAE,EAAE,cAAc,EAAE,cAAc,CAAE,CAAC;IAC5F,CAAC;IAED,iCAAkC,aAAoB,EAAE,cAAwC;QAAxC,8BAAwC,GAAxC,mBAAwC;QAC/F,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,uBAAuB,CAAE,IAAI,CAAC,EAAE,EAAE,aAAa,EAAE,cAAc,CAAE,CAAC;IAC1F,CAAC;;;;;;;;;;YAED;gBAAA;gBAyKA,CAAC;gBAxKO,0BAAkB,GAAzB,UAA2B,QAAuB;oBACjD,MAAM,CAAC,CACN,KAAK,CAAC,kBAAkB,CAAE,QAAQ,EAAE,YAAY,CAAE;wBAClD,KAAK,CAAC,kBAAkB,CAAE,QAAQ,EAAE,OAAO,CAAE;wBAC7C,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,SAAS,CAAE;wBACxC,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,MAAM,CAAE;wBACrC,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,SAAS,CAAE;wBAExC,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,oBAAoB,CAAE;wBACnD,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,iBAAiB,CAAE;wBAChD,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,uBAAuB,CAAE;wBACtD,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,oBAAoB,CAAE;wBACnD,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,yBAAyB,CAAE;wBACxD,KAAK,CAAC,WAAW,CAAE,QAAQ,EAAE,0BAA0B,CAAE,CACzD,CAAC;gBACH,CAAC;gBAEM,UAAE,GAAT,UAAW,MAAa;oBACvB,MAAM,CAAC;oBACN,iCAAiC;oBACjC,OAAO,CAAC,kBAAkB,CAAQ,MAAM,CAAE,CAC1C,CAAC;gBACH,CAAC;gBAEM,cAAM,GAAb,UAAe,GAAU,EAAE,SAAmB;oBAC7C,IAAI,QAAQ,GAAkB,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAE,GAAG,CAAE,CAAC;oBAE7D,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAE,QAAQ,EAAE,SAAS,CAAE,CAAC;gBAChD,CAAC;gBAEM,kBAAU,GAAjB,UAAqC,MAAQ,EAAE,GAAU,EAAE,SAAmB;oBAC7E,IAAI,QAAQ,GAAkB,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAE,MAAM,EAAE,GAAG,CAAE,CAAC;oBAEzE,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAE,QAAQ,EAAE,SAAS,CAAE,CAAC;gBAChD,CAAC;gBAEM,gBAAQ,GAAf,UAA2C,QAAU,EAAE,SAAmB;oBACzE,EAAE,CAAA,CAAE,OAAO,CAAC,kBAAkB,CAAE,QAAQ,CAAG,CAAC;wBAAC,MAAM,CAAO,QAAQ,CAAC;oBAEnE,IAAI,iBAAiB,GAAe,QAAQ,CAAC;oBAE7C,MAAM,CAAC,gBAAgB,CAAE,iBAAiB,EAAE;wBAC3C,YAAY,EAAE;4BACb,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,SAAS;yBAChB;wBACD,OAAO,EAAE;4BACR,QAAQ,EAAE,IAAI;4BACd,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,IAAI;yBACX;wBAED,YAAY,EAAE;4BACb,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,CAAE;gCACR,IAAI,aAAa,GAA4B,iBAAiB,CAAC,UAAU,CAAC;gCAC1E,MAAM,CAAC,UAAU,EAAS;oCACzB,EAAE,CAAA,CAAE,aAAa,CAAC,IAAI,CAAE,IAAI,EAAE,EAAE,CAAG,CAAC;wCAAC,MAAM,CAAC,IAAI,CAAC;oCAEjD,MAAM,CAAU,IAAK,CAAC,UAAU,CAAC,UAAU,CAAE,EAAE,CAAE,CAAC;gCACnD,CAAC,CAAC;4BACH,CAAC,CAAC,EAAE;yBACJ;wBACD,YAAY,EAAE;4BACb,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,CAAE;gCACR,IAAI,aAAa,GAAkC,iBAAiB,CAAC,UAAU,CAAC;gCAChF,IAAI,eAAe,GAA4B,iBAAiB,CAAC,OAAO,CAAC;gCACzE,MAAM,CAAC,UAAU,EAAS;oCACzB,EAAE,CAAA,CAAE,eAAe,CAAC,IAAI,CAAE,IAAI,EAAE,EAAE,CAAG,CAAC;wCAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAE,IAAI,EAAE,EAAE,CAAE,CAAC;oCAE7E,MAAM,CAAU,IAAK,CAAC,UAAU,CAAC,UAAU,CAAE,EAAE,CAAE,CAAC;gCACnD,CAAC,CAAC;4BACH,CAAC,CAAC,EAAE;yBACJ;wBACD,SAAS,EAAE;4BACV,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,CAAE;gCACR,IAAI,aAAa,GAA4B,iBAAiB,CAAC,OAAO,CAAC;gCACvE,MAAM,CAAC,UAAU,EAAS;oCACzB,EAAE,CAAA,CAAE,aAAa,CAAC,IAAI,CAAE,IAAI,EAAE,EAAE,CAAG,CAAC;wCAAC,MAAM,CAAC,IAAI,CAAC;oCAEjD,MAAM,CAAU,IAAK,CAAC,UAAU,CAAC,OAAO,CAAE,EAAE,CAAE,CAAC;gCAChD,CAAC,CAAC;4BACH,CAAC,CAAC,EAAE;yBACJ;wBAED,SAAS,EAAE;4BACV,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,OAAO;yBACd;wBACD,MAAM,EAAE;4BACP,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,IAAI;yBACX;wBACD,SAAS,EAAE;4BACV,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,OAAO;yBACd;wBAED,oBAAoB,EAAE;4BACrB,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,kBAAkB;yBACzB;wBACD,iBAAiB,EAAE;4BAClB,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,eAAe;yBACtB;wBACD,uBAAuB,EAAE;4BACxB,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,qBAAqB;yBAC5B;wBACD,oBAAoB,EAAE;4BACrB,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,kBAAkB;yBACzB;wBACD,0BAA0B,EAAE;4BAC3B,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,wBAAwB;yBAC/B;wBACD,yBAAyB,EAAE;4BAC1B,QAAQ,EAAE,KAAK;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,IAAI;4BAClB,KAAK,EAAE,uBAAuB;yBAC9B;qBACD,CAAE,CAAC;oBAEJ;;;;;;;;;;;sBAWE;oBAEF,MAAM,CAAO,iBAAiB,CAAC;gBAChC,CAAC;gBACF,cAAC;YAAD,CAzKA,AAyKC,IAAA;YAzKD,6BAyKC,CAAA","file":"PersistedDocument.js","sourcesContent":["import * as Document from \"./Document\";\nimport Documents from \"./Documents\";\nimport * as Errors from \"./Errors\";\nimport * as HTTP from \"./HTTP\";\nimport * as PersistedResource from \"./PersistedResource\";\nimport * as PersistedFragment from \"./PersistedFragment\";\nimport * as Pointer from \"./Pointer\";\nimport * as RDF from \"./RDF\";\nimport * as SPARQL from \"./SPARQL\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends Pointer.Class, PersistedResource.Class, Document.Class {\n\t_documents:Documents;\n\t_etag:string;\n\n\trefresh():Promise<void>;\n\tsave():Promise<void>;\n\tdestroy():Promise<void>;\n\n\texecuteRawASKQuery():Promise<[ SPARQL.RawResults.Class, HTTP.Response.Class ]>;\n\texecuteASKQuery():Promise<[ boolean, HTTP.Response.Class ]>;\n\texecuteRawSELECTQuery():Promise<[ SPARQL.RawResults.Class, HTTP.Response.Class ]>;\n\texecuteSELECTQuery():Promise<[ SPARQL.SELECTResults.Class, HTTP.Response.Class ]>;\n\texecuteRawDESCRIBEQuery():Promise<[ string, HTTP.Response.Class ]>;\n\texecuteRawCONSTRUCTQuery():Promise<[ string, HTTP.Response.Class ]>;\n}\n\nfunction isDirty():boolean {\n\t// TODO\n\treturn null;\n}\n\nfunction refresh():Promise<void> {\n\t// TODO\n\treturn null;\n}\nfunction save():Promise<void> {\n\treturn this._documents.save( this ).then( ( response:HTTP.Response.Class) => {\n\t\treturn [ this, response ];\n\t});\n}\nfunction destroy():Promise<void> {\n\treturn this._documents.delete( this );\n}\n\nfunction executeRawASKQuery( askQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ SPARQL.RawResults.Class, HTTP.Response.Class ]> {\n\treturn this._documents.executeRawASKQuery( this.id, askQuery, requestOptions );\n}\n\nfunction executeASKQuery( askQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ boolean, HTTP.Response.Class ]> {\n\treturn this._documents.executeASKQuery( this.id, askQuery, requestOptions );\n}\n\nfunction executeRawSELECTQuery( selectQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ SPARQL.RawResults.Class, HTTP.Response.Class ]> {\n\treturn this._documents.executeRawSELECTQuery( this.id, selectQuery, requestOptions );\n}\n\nfunction executeSELECTQuery( selectQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ SPARQL.SELECTResults.Class, HTTP.Response.Class ]> {\n\treturn this._documents.executeSELECTQuery( this.id, selectQuery, requestOptions );\n}\n\nfunction executeRawCONSTRUCTQuery( constructQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ string, HTTP.Response.Class ]> {\n\treturn this._documents.executeRawCONSTRUCTQuery( this.id, constructQuery, requestOptions );\n}\n\nfunction executeRawDESCRIBEQuery( describeQuery:string, requestOptions:HTTP.Request.Options = {} ):Promise<[ string, HTTP.Response.Class ]> {\n\treturn this._documents.executeRawDESCRIBEQuery( this.id, describeQuery, requestOptions );\n}\n\nexport class Factory {\n\tstatic hasClassProperties( document:Document.Class ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( document, \"_documents\" ) &&\n\t\t\tUtils.hasPropertyDefined( document, \"_etag\" ) &&\n\t\t\tUtils.hasFunction( document, \"refresh\" ) &&\n\t\t\tUtils.hasFunction( document, \"save\" ) &&\n\t\t\tUtils.hasFunction( document, \"destroy\" ) &&\n\n\t\t\tUtils.hasFunction( document, \"executeRawASKQuery\" ) &&\n\t\t\tUtils.hasFunction( document, \"executeASKQuery\" ) &&\n\t\t\tUtils.hasFunction( document, \"executeRawSELECTQuery\" ) &&\n\t\t\tUtils.hasFunction( document, \"executeSELECTQuery\" ) &&\n\t\t\tUtils.hasFunction( document, \"executeRawDESCRIBEQuery\" ) &&\n\t\t\tUtils.hasFunction( document, \"executeRawCONSTRUCTQuery\" )\n\t\t);\n\t}\n\n\tstatic is( object:Object ):boolean {\n\t\treturn (\n\t\t\t// TODO: Add Document.Class check\n\t\t\tFactory.hasClassProperties( <any> object )\n\t\t);\n\t}\n\n\tstatic create( uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.create( uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic createFrom<T extends Object>( object:T, uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.createFrom( object, uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic decorate<T extends Document.Class>( document:T, documents:Documents ):T & Class {\n\t\tif( Factory.hasClassProperties( document ) ) return <any> document;\n\n\t\tlet persistedDocument:Class = <any> document;\n\n\t\tObject.defineProperties( persistedDocument, {\n\t\t\t\"_documents\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: documents,\n\t\t\t},\n\t\t\t\"_etag\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: null,\n\t\t\t},\n\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.hasPointer;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.hasPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => Pointer.Class {\n\t\t\t\t\tlet superFunction:( id:string ) => Pointer.Class = persistedDocument.getPointer;\n\t\t\t\t\tlet inScopeFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):Pointer.Class {\n\t\t\t\t\t\tif( inScopeFunction.call( this, id ) ) return superFunction.call( this, id );\n\n\t\t\t\t\t\treturn (<Class> this)._documents.getPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.inScope( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\n\t\t\t\"refresh\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: refresh,\n\t\t\t},\n\t\t\t\"save\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: save,\n\t\t\t},\n\t\t\t\"destroy\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: destroy,\n\t\t\t},\n\n\t\t\t\"executeRawASKQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeRawASKQuery,\n\t\t\t},\n\t\t\t\"executeASKQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeASKQuery,\n\t\t\t},\n\t\t\t\"executeRawSELECTQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeRawSELECTQuery,\n\t\t\t},\n\t\t\t\"executeSELECTQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeSELECTQuery,\n\t\t\t},\n\t\t\t\"executeRawCONSTRUCTQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeRawCONSTRUCTQuery,\n\t\t\t},\n\t\t\t\"executeRawDESCRIBEQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeRawDESCRIBEQuery,\n\t\t\t},\n\t\t} );\n\n\t\t/*\n\n\t\t// TODO: Overwrite isDirty to also take into account the fragments state\n\t\t// TODO: Update with the new comparison system\n\t\tpersistedDocument.isDirty = (function():() => boolean {\n\t\t\tlet superFunction:() => boolean = persistedDocument.isDirty;\n\t\t\treturn function():boolean {\n\t\t\t\treturn superFunction.call( this ) || isDirty.call( this );\n\t\t\t};\n\t\t})();\n\n\t\t*/\n\n\t\treturn <any> persistedDocument;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}