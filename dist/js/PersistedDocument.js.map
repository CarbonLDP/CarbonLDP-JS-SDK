{"version":3,"sources":["PersistedDocument.ts"],"names":["isDirty","refresh","save","destroy","Factory","Factory.constructor","Factory.hasClassProperties","Factory.create","Factory.createFrom","Factory.decorate"],"mappings":"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","file":"PersistedDocument.js","sourcesContent":["import * as Document from \"./Document\";\nimport Documents from \"./Documents\";\nimport * as Errors from \"./Errors\";\nimport * as HTTP from \"./HTTP\";\nimport * as PersistedResource from \"./PersistedResource\";\nimport * as PersistedFragment from \"./PersistedFragment\";\nimport * as Pointer from \"./Pointer\";\nimport * as RDF from \"./RDF\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends Pointer.Class, PersistedResource.Class, Document.Class {\n\t_documents:Documents;\n\t_etag:string;\n\n\trefresh():Promise<void>;\n\tsave():Promise<void>;\n\tdestroy():Promise<void>;\n}\n\nfunction isDirty():boolean {\n\t// TODO\n\treturn null;\n}\n\nfunction refresh():Promise<void> {\n\t// TODO\n\treturn null;\n}\nfunction save():Promise<void> {\n\treturn this._documents.save( this ).then( ( response:HTTP.Response.Class) => {\n\t\t// TODO\n\t});\n}\nfunction destroy():Promise<void> {\n\treturn this._documents.delete( this ).then( ( response:HTTP.Response.Class) => {\n\t\t// TODO\n\t});\n}\n\nexport class Factory {\n\tstatic hasClassProperties( document:Document.Class ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( document, \"_decorate\" ) &&\n\t\t\tUtils.hasPropertyDefined( document, \"_etag\" ) &&\n\t\t\tUtils.hasFunction( document, \"refresh\" ) &&\n\t\t\tUtils.hasFunction( document, \"save\" ) &&\n\t\t\tUtils.hasFunction( document, \"destroy\" )\n\t\t);\n\t}\n\n\tstatic create( uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.create( uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic createFrom<T extends Object>( object:T, uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.createFrom( object, uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic decorate<T extends Document.Class>( document:T, documents:Documents ):T & Class {\n\t\tif( Factory.hasClassProperties( document ) ) return <any> document;\n\n\t\tlet persistedDocument:Class = <any> document;\n\n\t\tObject.defineProperties( persistedDocument, {\n\t\t\t\"_documents\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: documents,\n\t\t\t},\n\t\t\t\"_etag\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: null,\n\t\t\t},\n\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.hasPointer;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.hasPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => Pointer.Class {\n\t\t\t\t\tlet superFunction:( id:string ) => Pointer.Class = persistedDocument.getPointer;\n\t\t\t\t\tlet inScopeFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):Pointer.Class {\n\t\t\t\t\t\tif( inScopeFunction.call( this, id ) ) return superFunction.call( this, id );\n\n\t\t\t\t\t\treturn (<Class> this)._documents.getPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.inScope( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\n\t\t\t\"refresh\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: refresh,\n\t\t\t},\n\t\t\t\"save\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: save,\n\t\t\t},\n\t\t\t\"destroy\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: destroy,\n\t\t\t},\n\t\t} );\n\n\t\t/*\n\n\t\t// TODO: Overwrite isDirty to also take into account the fragments state\n\t\t// TODO: Update with the new comparison system\n\t\tpersistedDocument.isDirty = (function():() => boolean {\n\t\t\tlet superFunction:() => boolean = persistedDocument.isDirty;\n\t\t\treturn function():boolean {\n\t\t\t\treturn superFunction.call( this ) || isDirty.call( this );\n\t\t\t};\n\t\t})();\n\n\t\t*/\n\n\t\treturn <any> persistedDocument;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}