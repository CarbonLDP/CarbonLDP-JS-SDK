{"version":3,"sources":["PersistedDocument.ts"],"names":["isDirty","refresh","save","destroy","executeSELECTQuery","Factory","Factory.constructor","Factory.hasClassProperties","Factory.is","Factory.create","Factory.createFrom","Factory.decorate"],"mappings":"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","file":"PersistedDocument.js","sourcesContent":["import * as Document from \"./Document\";\nimport Documents from \"./Documents\";\nimport * as Errors from \"./Errors\";\nimport * as HTTP from \"./HTTP\";\nimport * as PersistedResource from \"./PersistedResource\";\nimport * as PersistedFragment from \"./PersistedFragment\";\nimport * as Pointer from \"./Pointer\";\nimport * as RDF from \"./RDF\";\nimport * as SPARQL from \"./SPARQL\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends Pointer.Class, PersistedResource.Class, Document.Class {\n\t_documents:Documents;\n\t_etag:string;\n\n\trefresh():Promise<void>;\n\tsave():Promise<void>;\n\tdestroy():Promise<void>;\n\n\texecuteSELECTQuery():Promise<[ SPARQL.Results.Class, HTTP.Response.Class ]>;\n}\n\nfunction isDirty():boolean {\n\t// TODO\n\treturn null;\n}\n\nfunction refresh():Promise<void> {\n\t// TODO\n\treturn null;\n}\nfunction save():Promise<void> {\n\treturn this._documents.save( this ).then( ( response:HTTP.Response.Class) => {\n\t\treturn [ this, response ];\n\t});\n}\nfunction destroy():Promise<void> {\n\treturn this._documents.delete( this );\n}\n\nfunction executeSELECTQuery( selectQuery:string ):Promise<[ SPARQL.Results.Class, HTTP.Response.Class ]> {\n\treturn this._documents.executeSELECTQuery( this.id, selectQuery );\n}\n\nexport class Factory {\n\tstatic hasClassProperties( document:Document.Class ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( document, \"_documents\" ) &&\n\t\t\tUtils.hasPropertyDefined( document, \"_etag\" ) &&\n\t\t\tUtils.hasFunction( document, \"refresh\" ) &&\n\t\t\tUtils.hasFunction( document, \"save\" ) &&\n\t\t\tUtils.hasFunction( document, \"destroy\" ) &&\n\n\t\t\tUtils.hasFunction( document, \"executeSELECTQuery\" )\n\t\t);\n\t}\n\n\tstatic is( object:Object ):boolean {\n\t\treturn (\n\t\t\t// TODO: Add Document.Class check\n\t\t\tFactory.hasClassProperties( <any> object )\n\t\t);\n\t}\n\n\tstatic create( uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.create( uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic createFrom<T extends Object>( object:T, uri:string, documents:Documents ):Class {\n\t\tlet document:Document.Class = Document.factory.createFrom( object, uri );\n\n\t\treturn Factory.decorate( document, documents );\n\t}\n\n\tstatic decorate<T extends Document.Class>( document:T, documents:Documents ):T & Class {\n\t\tif( Factory.hasClassProperties( document ) ) return <any> document;\n\n\t\tlet persistedDocument:Class = <any> document;\n\n\t\tObject.defineProperties( persistedDocument, {\n\t\t\t\"_documents\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: documents,\n\t\t\t},\n\t\t\t\"_etag\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: null,\n\t\t\t},\n\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.hasPointer;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.hasPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => Pointer.Class {\n\t\t\t\t\tlet superFunction:( id:string ) => Pointer.Class = persistedDocument.getPointer;\n\t\t\t\t\tlet inScopeFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):Pointer.Class {\n\t\t\t\t\t\tif( inScopeFunction.call( this, id ) ) return superFunction.call( this, id );\n\n\t\t\t\t\t\treturn (<Class> this)._documents.getPointer( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: ( function():( id:string ) => boolean {\n\t\t\t\t\tlet superFunction:( id:string ) => boolean = persistedDocument.inScope;\n\t\t\t\t\treturn function( id:string ):boolean {\n\t\t\t\t\t\tif( superFunction.call( this, id ) ) return true;\n\n\t\t\t\t\t\treturn (<Class> this)._documents.inScope( id );\n\t\t\t\t\t};\n\t\t\t\t})(),\n\t\t\t},\n\n\t\t\t\"refresh\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: refresh,\n\t\t\t},\n\t\t\t\"save\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: save,\n\t\t\t},\n\t\t\t\"destroy\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: destroy,\n\t\t\t},\n\n\t\t\t\"executeSELECTQuery\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: executeSELECTQuery,\n\t\t\t},\n\t\t} );\n\n\t\t/*\n\n\t\t// TODO: Overwrite isDirty to also take into account the fragments state\n\t\t// TODO: Update with the new comparison system\n\t\tpersistedDocument.isDirty = (function():() => boolean {\n\t\t\tlet superFunction:() => boolean = persistedDocument.isDirty;\n\t\t\treturn function():boolean {\n\t\t\t\treturn superFunction.call( this ) || isDirty.call( this );\n\t\t\t};\n\t\t})();\n\n\t\t*/\n\n\t\treturn <any> persistedDocument;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}