{"version":3,"sources":["PersistedDocument.ts"],"names":["isDirty","refresh","save","destroy","Factory","Factory.constructor","Factory.hasClassProperties","Factory.from","Factory.singleFrom","Factory.injectBehavior"],"mappings":"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","file":"PersistedDocument.js","sourcesContent":["import Context from \"./Context\";\nimport * as Document from \"./Document\";\nimport * as Errors from \"./Errors\";\nimport * as HTTP from \"./HTTP\";\nimport * as PersistedResource from \"./PersistedResource\";\nimport * as PersistedFragment from \"./PersistedFragment\";\nimport * as RDF from \"./RDF\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends PersistedResource.Class, Document.Class {\n\t_context:Context;\n\t_etag:string;\n\n\trefresh():Promise<void>;\n\tsave():Promise<void>;\n\tdestroy():Promise<void>;\n}\n\nfunction isDirty():boolean {\n\tfor( let fragment of this.getFragments() ) {\n\t\tif( fragment.isDirty() ) return true;\n\t}\n\treturn false;\n}\n\nfunction refresh():Promise<void> {\n\t// TODO\n\treturn null;\n}\nfunction save():Promise<void> {\n\treturn this._context.Documents.save( this ).then( ( response:HTTP.Response.Class) => {\n\t\t// TODO\n\t});\n}\nfunction destroy():Promise<void> {\n\treturn this._context.Documents.delete( this ).then( ( response:HTTP.Response.Class) => {\n\t\t// TODO\n\t});\n}\n\nexport class Factory {\n\tstatic hasClassProperties( document:Document.Class ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( document, \"_context\" ) &&\n\t\t\tUtils.hasPropertyDefined( document, \"_etag\" ) &&\n\t\t\tUtils.hasFunction( document, \"refresh\" ) &&\n\t\t\tUtils.hasFunction( document, \"save\" ) &&\n\t\t\tUtils.hasFunction( document, \"destroy\" )\n\t\t);\n\t}\n\n\tstatic from( documents:Document.Class[], context:Context ):Class[];\n\tstatic from( document:Document.Class, context:Context ):Class;\n\tstatic from( documents:any, context:Context ):any {\n\t\tif( ! context ) throw new Errors.IllegalArgumentError( \"The context cannot be null/undefined.\" );\n\t\tif( ! Utils.isArray( documents ) ) return Factory.singleFrom( <Document.Class> documents, context );\n\n\t\tfor ( let i:number = 0, length:number = documents.length; i < length; i ++ ) {\n\t\t\tlet document:Document.Class = documents[ i ];\n\t\t\tFactory.singleFrom( document, context );\n\t\t}\n\n\t\treturn <Document.Class[]> documents;\n\t}\n\n\tprotected static singleFrom( document:Document.Class, context:Context ):Class {\n\t\tlet persisted:( Document.Class & PersistedResource.Class ) = PersistedResource.Factory.from<Document.Class>( document );\n\n\t\tlet persistedDocument:Class = Factory.hasClassProperties( document ) ? <any> persisted : Factory.injectBehavior( persisted, context );\n\n\t\tPersistedFragment.Factory.from( persistedDocument.getFragments() );\n\n\t\treturn persistedDocument;\n\t}\n\n\tprotected static injectBehavior( persisted:( Document.Class & PersistedResource.Class ), context:Context ):Class {\n\t\tif( Factory.hasClassProperties( persisted ) ) return <any> persisted;\n\n\t\tObject.defineProperties( persisted, {\n\t\t\t\"_context\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: context,\n\t\t\t},\n\t\t\t\"_etag\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\t\"refresh\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: refresh,\n\t\t\t},\n\t\t\t\"save\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: save,\n\t\t\t},\n\t\t\t\"destroy\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: destroy,\n\t\t\t},\n\t\t} );\n\n\t\t// Overwrite isDirty to also take into account the fragments state\n\t\tpersisted.isDirty = (function():() => boolean {\n\t\t\tlet superFunction:() => boolean = persisted.isDirty;\n\t\t\treturn function():boolean {\n\t\t\t\treturn superFunction.call( this ) || isDirty.call( this );\n\t\t\t};\n\t\t})();\n\n\t\treturn <any> persisted;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}