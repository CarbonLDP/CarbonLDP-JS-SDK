{"version":3,"sources":["PersistedDocument.ts"],"names":["SpecialValue","modificationsDeleteAllValues","getModifications","addModification","removeModification","registerAddModification","registerDeleteModification","isDirty","refresh","save","destroy","Factory","Factory.constructor","Factory.hasClassProperties","Factory.from","Factory.singleFrom","Factory.injectBehavior"],"mappings":"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","file":"PersistedDocument.js","sourcesContent":["import Context from \"./Context\";\nimport * as Document from \"./Document\";\nimport * as Errors from \"./Errors\";\nimport * as PersistedResource from \"./PersistedResource\";\nimport * as PersistedFragment from \"./PersistedFragment\";\nimport * as RDF from \"./RDF\";\nimport * as Utils from \"./Utils\";\n\nenum SpecialValue {\n\tALL_VALUES\n}\n\nexport interface Class extends PersistedResource.Class, Document.Class {\n\t_context:Context;\n\t_etag:string;\n\n\trefresh():Promise<void>;\n\tsave():Promise<void>;\n\tdestroy():Promise<void>;\n}\n\nfunction modificationsDeleteAllValues( deleteModifications:RDF.Value.Class[] ):boolean {\n\treturn deleteModifications.length === 1 && deleteModifications[ 0 ] === SpecialValue.ALL_VALUES;\n}\n\nfunction getModifications( type:PersistedResource.ModificationType ):Map<string, RDF.Value.Class[]> {\n\tlet modifications:Map<string, RDF.Value.Class[]>;\n\tswitch ( type ) {\n\t\tcase PersistedResource.ModificationType.ADD:\n\t\t\tmodifications = this._modifications.add;\n\t\t\tbreak;\n\t\tcase PersistedResource.ModificationType.SET:\n\t\t\tmodifications = this._modifications.set;\n\t\t\tbreak;\n\t\tcase PersistedResource.ModificationType.DELETE:\n\t\t\tmodifications = this._modifications.delete;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Errors.IllegalStateError( \"\" );\n\t}\n\treturn modifications;\n}\n\nfunction addModification( type:PersistedResource.ModificationType, propertyURI:string, value:any ):void {\n\tlet modifications:Map<string, RDF.Value.Class[]> = getModifications.call( this, type, propertyURI );\n\n\tlet values:RDF.Value.Class[];\n\tif ( modifications.has( propertyURI ) ) {\n\t\tvalues = modifications.get( propertyURI );\n\t\tfor ( let i:number = 0, length:number = values.length; i < length; i ++ ) {\n\t\t\tif ( RDF.Value.Util.areEqual( values[ i ], value ) ) return;\n\t\t}\n\t} else {\n\t\tvalues = [];\n\t\tmodifications.set( propertyURI, values );\n\t}\n\n\tvalues.push( value );\n}\n\nfunction removeModification( type:PersistedResource.ModificationType, propertyURI:string, value:any ):void {\n\tlet modifications:Map<string, RDF.Value.Class[]> = getModifications.call( this, type, propertyURI );\n\tlet values:RDF.Value.Class[] = modifications.get( propertyURI );\n\tfor ( let i:number = 0, length:number = values.length; i < length; i ++ ) {\n\t\tif ( RDF.Value.Util.areEqual( values[ i ], value ) ) {\n\t\t\tvalues.splice( i, 1 );\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nfunction registerAddModification( propertyURI:string, value:any ):void {\n\tthis._dirty = true;\n\n\tif ( this._modifications.delete.has( propertyURI ) ) {\n\t\tlet deleteModifications:RDF.Value.Class[] = this._modifications.delete.get( propertyURI );\n\n\t\tif ( modificationsDeleteAllValues( deleteModifications ) ) {\n\t\t\tthis._modifications.delete.delete( propertyURI );\n\t\t\taddModification.call( this, PersistedResource.ModificationType.SET, propertyURI, value );\n\t\t\treturn;\n\t\t}\n\n\t\tremoveModification.call( this, PersistedResource.ModificationType.DELETE, propertyURI, value );\n\n\t\tfor ( let i:number = 0, length:number = deleteModifications.length; i < length; i ++ ) {\n\t\t\tif ( RDF.Value.Util.areEqual( deleteModifications[ i ], value ) ) {\n\t\t\t\tdeleteModifications.splice( i, 1 );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else if ( this._modifications.set.has( propertyURI ) ) {\n\t\taddModification.call( this, PersistedResource.ModificationType.SET, propertyURI, value );\n\t} else {\n\t\taddModification.call( this, PersistedResource.ModificationType.ADD, propertyURI, value );\n\t}\n}\n\nfunction registerDeleteModification( propertyURI:string, value:any = null ):void {\n\tthis._dirty = true;\n\n\tif ( Utils.isNull( value ) ) value = SpecialValue.ALL_VALUES;\n\n\tif ( value === SpecialValue.ALL_VALUES ) {\n\t\tif ( this._modifications.add.has( propertyURI ) ) this._modifications.add.delete( propertyURI );\n\t\tif ( this._modifications.set.has( propertyURI ) ) this._modifications.set.delete( propertyURI );\n\t\tif ( this._modifications.delete.has( propertyURI ) ) this._modifications.delete.delete( propertyURI );\n\t} else {\n\t\tif ( this._modifications.add.has( propertyURI ) ) removeModification.call( this, PersistedResource.ModificationType.ADD, propertyURI, value );\n\t\tif ( this._modifications.set.has( propertyURI ) ) removeModification.call( this, PersistedResource.ModificationType.SET, propertyURI, value );\n\t}\n\n\taddModification.call( this, PersistedResource.ModificationType.DELETE, propertyURI, value );\n}\n\nfunction isDirty():boolean {\n\t/* tslint:disable: typedef */\n\tfor( let fragment of this.getFragments() ) {\n\t\t/* tslint:enable: typedef */\n\t\tif( fragment.isDirty() ) return true;\n\t}\n\treturn false;\n}\n\nfunction refresh():Promise<void> {\n\t// TODO\n\treturn null;\n}\nfunction save():Promise<void> {\n\t// TODO: FT\n\treturn this._context.Documents.save( this );\n}\nfunction destroy():Promise<void> {\n\t// TODO\n\treturn null;\n}\n\nexport class Factory {\n\tstatic hasClassProperties( document:Document.Class ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( document, \"_context\" ) &&\n\t\t\tUtils.hasPropertyDefined( document, \"_etag\" ) &&\n\t\t\tUtils.hasFunction( document, \"refresh\" ) &&\n\t\t\tUtils.hasFunction( document, \"save\" ) &&\n\t\t\tUtils.hasFunction( document, \"destroy\" )\n\t\t);\n\t}\n\n\tstatic from( documents:Document.Class[], context:Context ):Class[];\n\tstatic from( document:Document.Class, context:Context ):Class;\n\tstatic from( documents:any, context:Context ):any {\n\t\tif( ! context ) throw new Errors.IllegalArgumentError( \"The context cannot be null/undefined.\" );\n\t\tif( ! Utils.isArray( documents ) ) return Factory.singleFrom( <Document.Class> documents, context );\n\n\t\tfor ( let i:number = 0, length:number = documents.length; i < length; i ++ ) {\n\t\t\tlet document:Document.Class = documents[ i ];\n\t\t\tFactory.singleFrom( document, context );\n\t\t}\n\n\t\treturn <Document.Class[]> documents;\n\t}\n\n\tprotected static singleFrom( document:Document.Class, context:Context ):Class {\n\t\tlet persisted:( Document.Class & PersistedResource.Class ) = PersistedResource.Factory.from<Document.Class>( document );\n\n\t\tlet persistedDocument:Class = Factory.hasClassProperties( document ) ? <any> persisted : Factory.injectBehavior( persisted, context );\n\n\t\tPersistedFragment.Factory.from( persistedDocument.getFragments() );\n\n\t\treturn persistedDocument;\n\t}\n\n\tprotected static injectBehavior( persisted:( Document.Class & PersistedResource.Class ), context:Context ):Class {\n\t\tif( Factory.hasClassProperties( persisted ) ) return <any> persisted;\n\n\t\tObject.defineProperties( persisted, {\n\t\t\t\"_context\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: context\n\t\t\t},\n\t\t\t\"_etag\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\t\"refresh\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: refresh\n\t\t\t},\n\t\t\t\"save\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: save\n\t\t\t},\n\t\t\t\"destroy\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: destroy\n\t\t\t}\n\t\t} );\n\n\t\t// Overwrite isDirty to also take into account the fragments state\n\t\tpersisted.isDirty = (function():() => boolean {\n\t\t\tlet superFunction:() => boolean = persisted.isDirty;\n\t\t\treturn function():boolean {\n\t\t\t\treturn superFunction.call( this ) || isDirty.call( this );\n\t\t\t};\n\t\t})();\n\n\t\tpersisted._propertyAddedCallbacks.push( registerAddModification );\n\t\tpersisted._propertyDeletedCallbacks.push( registerDeleteModification );\n\n\t\treturn <any> persisted;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}