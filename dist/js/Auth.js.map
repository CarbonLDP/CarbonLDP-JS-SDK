{"version":3,"sources":["Auth.ts"],"names":["Method","Auth","Auth.constructor","Auth.isAuthenticated","Auth.login","Auth.addAuthentication","Auth.basicAuthentication","Auth.addBasicAuthHeader"],"mappings":"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","file":"Auth.js","sourcesContent":["/// <reference path=\"../typings/es6-promise/es6-promise.d.ts\" />\nimport * as HTTP from './HTTP';\nimport * as Errors from './Errors';\nimport Parent from './Parent';\n\nenum Method {\n\tBasic\n}\n\nexport interface Credentials {\n\tusername:string;\n\tpassword:string;\n}\n\nclass Auth {\n\tprivate parent:Parent;\n\n\tprivate authenticated:boolean = false;\n\tprivate method:Method = null;\n\tprivate credentials:Credentials;\n\n\tconstructor( parent:Parent ) {\n\t\tthis.parent = parent;\n\t}\n\n\tisAuthenticated( askParent:boolean = true ):boolean {\n\t\t//@formatter:off\n\t\treturn (\n\t\t\tthis.authenticated ||\n\t\t\t(askParent && ! ! this.parent.parent && this.parent.parent.Auth.isAuthenticated())\n\t\t);\n\t\t//@formatter:on\n\t}\n\n\tlogin( username:string, password:string ):Promise<void> {\n\t\tvar method:Method = <any> this.parent.getSetting( \"auth.method\" );\n\n\t\tswitch ( method ) {\n\t\t\tcase Method.Basic:\n\t\t\t\treturn this.basicAuthentication( username, password );\n\t\t\tdefault:\n\t\t\t\treturn new Promise<void>( function () {\n\t\t\t\t\tthrow new Errors.IllegalStateError( 'The authentication method specified isn\\'t supported.' );\n\t\t\t\t} );\n\t\t}\n\t}\n\n\taddAuthentication( requestOptions:HTTP.Request.Options ):void {\n\t\tif( ! this.isAuthenticated( false ) ) {\n\t\t\tif( this.parent.parent ) {\n\t\t\t\tthis.parent.parent.Auth.addAuthentication( requestOptions);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tconsole.warn( \"There is no authentication to add to the request.\" );\n\t\t\t}\n\t\t}\n\n\t\tvar headers:Map<string, HTTP.Header.Class> = requestOptions.headers ? requestOptions.headers : requestOptions.headers = new Map<string, HTTP.Header.Class>();\n\t\tswitch ( this.method ) {\n\t\t\tcase Method.Basic:\n\t\t\t\tthis.addBasicAuthHeader( headers );\n\t\t\t\trequestOptions.sendCredentialsOnCORS = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\n\tprivate basicAuthentication( username, password ):Promise<void> {\n\t\treturn new Promise<void>( ( resolve, reject ) => {\n\t\t\t// TODO: Check that the credentials are valid\n\t\t\tthis.credentials = {\n\t\t\t\tusername: username,\n\t\t\t\tpassword: password\n\t\t\t};\n\n\t\t\tthis.method = Method.Basic;\n\t\t\tthis.authenticated = true;\n\n\t\t\tresolve();\n\t\t} );\n\t}\n\n\tprivate addBasicAuthHeader( headers:Map<string, HTTP.Header.Class> ):void {\n\t\tvar header:HTTP.Header.Class;\n\t\tif ( headers.has( 'Authorization' ) ) header = headers.get( 'Authorization' );\n\t\telse {\n\t\t\theader = new HTTP.Header.Class();\n\t\t\theaders.set( 'Authorization', header );\n\t\t}\n\t\tvar authorization = 'Basic ' + btoa( this.credentials.username + ':' + this.credentials.password );\n\t\theader.values.push( new HTTP.Header.Value( authorization ) );\n\t}\n\n\n}\n\n//@formatter:off\nexport default Auth;\nexport {\n\tAuth as Class,\n\tMethod\n};\n//@formatter:on"],"sourceRoot":"/source/"}