{"version":3,"sources":["Resource/PersistedResource.ts"],"names":[],"mappings":";;AAAA,6BAAkC;AAClC,gCAAyC;AAEzC,kCAIkB;AAClB,yDAAwD;AAmBxD,wBAAyB,MAAU,EAAE,MAAU;IAC9C,IAAI,CAAE,gBAAQ,CAAE,MAAM,CAAE,IAAI,CAAE,gBAAQ,CAAE,MAAM,CAAE;QAAG,OAAO;IAE1D,IAAI,GAAG,CACH,MAAM,CAAC,IAAI,CAAE,MAAM,CAAE,QACrB,MAAM,CAAC,IAAI,CAAE,MAAM,CAAE,EACtB,CAAC,OAAO,CAAE,UAAA,GAAG;QACf,IAAM,WAAW,GAAO,KAAK,CAAC,OAAO,CAAE,MAAM,CAAE,GAAG,CAAE,CAAE,CAAC,CAAC,CAClD,MAAM,CAAE,GAAG,CAAE,SAAG,CAAC,CAAC,MAAM,CAAE,GAAG,CAAE,CAAC;QAEtC,IAAI,WAAW,KAAK,IAAI,IAAI,WAAW,KAAK,KAAK,CAAC,EAAG;YACpD,OAAO,MAAM,CAAE,GAAG,CAAE,CAAC;YACrB,OAAO;SACP;QAED,IAAI,iBAAU,CAAE,WAAW,CAAE;YAAG,OAAO;QAEvC,MAAM,CAAE,GAAG,CAAE,GAAG,WAAW,CAAC;IAC7B,CAAC,CAAE,CAAC;AACL,CAAC;AAED,IAAM,SAAS,GAAuD;IACrE,IAAI,SAAS,KAAQ,OAAO,EAAE,CAAC,CAAC,CAAC;IACjC,gBAAgB,EAAE,KAAK,CAAC;IAGxB,aAAa,EAAb;QACC,IAAM,KAAK,GAAqB,mBAAW,CAAC,KAAK,CAAE,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAE,CAAC;QAC5E,KAAK,CAAC,KAAK,GAAQ,IAAI,CAAC,KAAK,QAAE,CAAC;QAEhC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;IACxB,CAAC;IAED,OAAO,EAAP;QACC,OAAO,CAAE,mBAAW;aAClB,QAAQ,CAAE,IAAI,EAAE,IAAI,CAAC,SAAS,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAE,CAAC;IACtD,CAAC;IAED,MAAM,EAAN;QACC,cAAc,CAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAE,CAAC;QACvC,IAAI,CAAE,IAAI,CAAC,KAAK;YAAG,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;IACpC,CAAC;IAGD,SAAS,EAAT;QACC,OAAO,CAAE,CAAE,IAAI,CAAC,gBAAgB,CAAC;IAClC,CAAC;CACD,CAAC;AAeW,QAAA,iBAAiB,GAA4B;IACzD,SAAS,WAAA;IAGT,WAAW,EAAX,UAAa,MAAa;QACzB,OAAO,gBAAQ,CAAE,MAAM,CAAE;eACrB,qBAAc;iBACf,iBAAiB,CAAE,SAAS,EAAE,MAAM,CAAE,CACvC;IACH,CAAC;IAED,EAAE,EAAF,UAAI,KAAS;QACZ,OAAO,gBAAQ,CAAE,KAAK,CAAE;eACpB,yBAAiB,CAAC,WAAW,CAAE,KAAK,CAAE,CACxC;IACH,CAAC;IAGD,QAAQ,EAAR,UAA4B,MAAQ;QACnC,IAAI,yBAAiB,CAAC,WAAW,CAAE,MAAM,CAAE;YAAG,OAAO,MAAM,CAAC;QAE5D,IAAM,QAAQ,GAAyB,qCAAiB,CAAC,QAAQ,CAAE,MAAM,CAAE,CAAC;QAE5E,OAAO,qBAAc;aACnB,oBAAoB,CAAE,SAAS,EAAE,QAAQ,CAAE,CAAC;IAC/C,CAAC;CACD,CAAC","file":"PersistedResource.js","sourcesContent":["import { isFunction } from \"util\";\nimport { ModelDecorator } from \"../core\";\nimport { PartialMetadata } from \"../SPARQL/QueryDocument\";\nimport {\n\tisObject,\n\tObjectUtils,\n\tPickSelfProps,\n} from \"../Utils\";\nimport { TransientResource } from \"./TransientResource\";\n\n\nexport interface PersistedResource extends TransientResource {\n\t_snapshot:object | undefined;\n\t_partialMetadata:PartialMetadata | undefined;\n\n\n\t_syncSnapshot():void;\n\n\tisDirty():boolean;\n\n\trevert():void;\n\n\n\tisPartial():boolean;\n}\n\n\nfunction internalRevert( target:any, source:any ):void {\n\tif( ! isObject( target ) || ! isObject( source ) ) return;\n\n\tnew Set<string>( [\n\t\t...Object.keys( target ),\n\t\t...Object.keys( source ),\n\t] ).forEach( key => {\n\t\tconst sourceValue:any = Array.isArray( source[ key ] ) ?\n\t\t\t[ ...source[ key ] ] : source[ key ];\n\n\t\tif( sourceValue === null || sourceValue === void 0 ) {\n\t\t\tdelete target[ key ];\n\t\t\treturn;\n\t\t}\n\n\t\tif( isFunction( sourceValue ) ) return;\n\n\t\ttarget[ key ] = sourceValue;\n\t} );\n}\n\nconst PROTOTYPE:PickSelfProps<PersistedResource, TransientResource> = {\n\tget _snapshot():{} { return {}; },\n\t_partialMetadata: void 0,\n\n\n\t_syncSnapshot( this:PersistedResource ):void {\n\t\tconst clone:PersistedResource = ObjectUtils.clone( this, { arrays: true } );\n\t\tclone.types = [ ...this.types ];\n\n\t\tthis._snapshot = clone;\n\t},\n\n\tisDirty( this:PersistedResource ):boolean {\n\t\treturn ! ObjectUtils\n\t\t\t.areEqual( this, this._snapshot, { arrays: true } );\n\t},\n\n\trevert( this:PersistedResource ):void {\n\t\tinternalRevert( this, this._snapshot );\n\t\tif( ! this.types ) this.types = [];\n\t},\n\n\n\tisPartial( this:PersistedResource ):boolean {\n\t\treturn ! ! this._partialMetadata;\n\t},\n};\n\nexport interface PersistedResourceFactory {\n\tPROTOTYPE:PickSelfProps<PersistedResource, TransientResource>;\n\n\n\tisDecorated( object:object ):object is PersistedResource;\n\n\tis( value:any ):value is PersistedResource;\n\n\n\tdecorate<T extends object>( object:T ):T & PersistedResource;\n}\n\n\nexport const PersistedResource:PersistedResourceFactory = {\n\tPROTOTYPE,\n\n\n\tisDecorated( object:object ):object is PersistedResource {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tis( value:any ):value is PersistedResource {\n\t\treturn isObject( value )\n\t\t\t&& PersistedResource.isDecorated( value )\n\t\t\t;\n\t},\n\n\n\tdecorate<T extends object>( object:T ):T & PersistedResource {\n\t\tif( PersistedResource.isDecorated( object ) ) return object;\n\n\t\tconst resource:T & TransientResource = TransientResource.decorate( object );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( PROTOTYPE, resource );\n\t},\n};\n"]}