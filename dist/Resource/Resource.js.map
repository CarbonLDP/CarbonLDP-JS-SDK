{"version":3,"sources":["Resource/Resource.ts"],"names":[],"mappings":";;AAIA,6DAA4D;AAE5D,0DAAyD;AAKzD,6EAA4E;AAE5E,8CAA6C;AAG7C,kCAAiC;AAEjC,mEAAkE;AAGlE,kCAAoC;AAuBpC,sBAAuB,QAAyD;IAC/E,EAAE,CAAA,CAAE,CAAE,QAAS,CAAC;QAAC,MAAM,CAAC;IACxB,EAAE,CAAA,CAAE,UAAU,IAAI,QAAQ,IAAI,QAAQ,CAAC,QAAS,CAAC;QAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;IAE3E,MAAM,CAAC,YAAY,CAAE,QAAQ,CAAC,SAAS,CAAE,CAAC;AAC3C,CAAC;AAED,sBAAuB,QAAiB,EAAE,GAAU;IACnD,EAAE,CAAA,CAAE,SAAG,CAAC,UAAU,CAAE,GAAG,CAAG,CAAC;QAAC,MAAM,CAAC,GAAG,CAAC;IAEvC,IAAM,OAAO,GAAuB,YAAY,CAAE,QAAQ,CAAC,SAAS,CAAE,CAAC;IACvE,EAAE,CAAA,CAAE,CAAE,OAAQ,CAAC;QAAC,MAAM,CAAC,GAAG,CAAC;IAE3B,MAAM,CAAC,OAAO;SACZ,eAAe,EAAE;SACjB,UAAU,CAAE,GAAG,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAE,CAAC;AACtC,CAAC;AASY,QAAA,QAAQ,GAAmB;IACvC,SAAS,EAAE;QACV,IAAI,KAAK,KAAc,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;QAEnC,IAAI,KAAK;YACR,EAAE,CAAA,CAAE,SAAG,CAAC,SAAS,CAAE,IAAI,CAAC,GAAG,CAAG,CAAC;gBAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;YAChD,MAAM,CAAC,SAAG,CAAC,OAAO,CAAE,IAAI,CAAC,GAAG,CAAE,CAAC;QAChC,CAAC;QACD,IAAI,KAAK,CAAiB,IAAW,IAAI,CAAC;QAG1C,OAAO,EAAP,UAAwB,IAAW;YAClC,IAAI,GAAG,YAAY,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;YAElC,EAAE,CAAA,CAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAE,IAAI,CAAE,KAAK,CAAE,CAAE,CAAC;gBAAC,MAAM,CAAC;YAEhD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAE,IAAI,CAAE,CAAC;QACzB,CAAC;QAED,OAAO,EAAP,UAAwB,IAAW;YAClC,IAAI,GAAG,YAAY,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAE,IAAI,CAAE,KAAK,CAAE,CAAC,CAAC;QAC3C,CAAC;QAED,UAAU,EAAV,UAA2B,IAAW;YACrC,IAAI,GAAG,YAAY,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;YAElC,IAAM,KAAK,GAAU,IAAI,CAAC,KAAK,CAAC,OAAO,CAAE,IAAI,CAAE,CAAC;YAChD,EAAE,CAAA,CAAE,KAAK,KAAK,CAAE,CAAE,CAAC;gBAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAE,KAAK,EAAE,CAAC,CAAE,CAAC;QACnD,CAAC;QAGD,MAAM,EAAN,UAAuB,YAA8B;YACpD,IAAM,OAAO,GAAuB,OAAO,YAAY,KAAK,QAAQ,CAAC,CAAC;gBACrE,YAAY,CAAC,CAAC,CAAC,YAAY,CAAE,IAAI,CAAC,SAAS,CAAE,CAAC;YAE/C,IAAM,aAAa,GAAwB,OAAO,CAAC,CAAC;gBACnD,OAAO,CAAC,QAAQ,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC,IAAI,2CAAoB,EAAE,CAAC;YAElE,IAAM,cAAc,GAAwB,OAAO,IAAI,OAAO,CAAC,QAAQ,CAAC,CAAC;gBACxE,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAE,IAAI,CAAE,CAAC,CAAC,CAAC,aAAa,CAAC;YAEvD,IAAM,eAAe,GAAmB,OAAO,CAAC,CAAC;gBAChD,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,iCAAe,EAAE,CAAC;YAEjD,MAAM,CAAC,eAAe,CAAC,MAAM,CAAE,IAAI,EAAE,aAAa,EAAE,cAAc,CAAE,CAAC;QACtE,CAAC;KACD;IAED,WAAW,EAAX,UAAa,MAAa;QACzB,MAAM,CAAC,gBAAQ,CAAE,MAAM,CAAE;eACrB,+BAAc;iBACf,iBAAiB,CAAE,gBAAQ,CAAC,SAAS,EAAE,MAAM,CAAE,CAAC;IACpD,CAAC;IAED,EAAE,EAAF,UAAI,KAAS;QACZ,MAAM,CAAC,iBAAO,CAAC,EAAE,CAAE,KAAK,CAAE;eACtB,gBAAQ,CAAC,WAAW,CAAE,KAAK,CAAE,CAAC;IACnC,CAAC;IAED,MAAM,EAAN,UAA0B,IAAsB;QAC/C,IAAM,KAAK,GAAK,MAAM,CAAC,MAAM,CAAE,EAAE,EAAE,IAAI,CAAE,CAAC;QAC1C,MAAM,CAAC,gBAAQ,CAAC,UAAU,CAAK,KAAK,CAAE,CAAC;IACxC,CAAC;IAED,UAAU,EAAV,UAA8B,MAAuB;QACpD,MAAM,CAAC,gBAAQ,CAAC,QAAQ,CAAK,MAAM,CAAE,CAAC;IACvC,CAAC;IAED,QAAQ,EAAR,UAAkC,MAAQ;QACzC,EAAE,CAAA,CAAE,gBAAQ,CAAC,WAAW,CAAE,MAAM,CAAG,CAAC;YAAC,MAAM,CAAC,MAAM,CAAC;QAEnD,EAAE,CAAA,CAAE,CAAE,MAAM,CAAC,cAAc,CAAE,WAAW,CAAG,CAAC;YAAC,MAAM,CAAC,SAAS,GAAG,KAAK,CAAC,CAAC;QAEvE,IAAM,QAAQ,GAAyB,+BAAc;aACnD,gBAAgB,CAAE,MAAqC,EAAE,qCAAiB,CAAE,CAAC;QAE/E,MAAM,CAAC,+BAAc;aACnB,oBAAoB,CAAE,gBAAQ,CAAC,SAAS,EAAE,QAAQ,CAAE,CAAC;IACxD,CAAC;CACD,CAAC","file":"Resource.js","sourcesContent":["import { Context } from \"../Context/Context\";\n\nimport { GeneralRegistry } from \"../GeneralRegistry/GeneralRegistry\";\n\nimport { JSONLDConverter } from \"../JSONLD/JSONLDConverter\";\n\nimport { ModelDecorator } from \"../Model/ModelDecorator\";\nimport { ModelFactoryOptional } from \"../Model/ModelFactoryOptional\";\nimport { ModelPrototype } from \"../Model/ModelPrototype\";\nimport { ModelTypeGuard } from \"../Model/ModelTypeGuard\";\n\nimport { DigestedObjectSchema } from \"../ObjectSchema/DigestedObjectSchema\";\n\nimport { Pointer } from \"../Pointer/Pointer\";\n\nimport { RDFNode } from \"../RDF/Node\";\nimport { URI } from \"../RDF/URI\";\n\nimport { RegisteredPointer } from \"../Registry/RegisteredPointer\";\nimport { Registry } from \"../Registry/Registry\";\n\nimport { isObject } from \"../Utils\";\n\nimport { BaseResource } from \"./BaseResource\";\n\n\nexport interface Resource extends RegisteredPointer {\n\ttypes:string[];\n\n\t$registry:Registry<RegisteredPointer> | undefined;\n\t$slug:string;\n\n\n\taddType( type:string ):void;\n\n\thasType( type:string ):boolean;\n\n\tremoveType( type:string ):void;\n\n\n\ttoJSON( contextOrKey:Context | string ):RDFNode;\n}\n\n\nfunction __getContext( registry:Registry<any> | GeneralRegistry<any> | undefined ):Context | undefined {\n\tif( ! registry ) return;\n\tif( \"$context\" in registry && registry.$context ) return registry.$context;\n\n\treturn __getContext( registry.$registry );\n}\n\nfunction __resolveURI( resource:Resource, uri:string ):string {\n\tif( URI.isAbsolute( uri ) ) return uri;\n\n\tconst context:Context | undefined = __getContext( resource.$registry );\n\tif( ! context ) return uri;\n\n\treturn context\n\t\t.getObjectSchema()\n\t\t.resolveURI( uri, { vocab: true } );\n}\n\nexport type ResourceFactory =\n\t& ModelPrototype<Resource, RegisteredPointer>\n\t& ModelDecorator<Resource, BaseResource>\n\t& ModelFactoryOptional<Resource>\n\t& ModelTypeGuard<Resource>\n\t;\n\nexport const Resource:ResourceFactory = {\n\tPROTOTYPE: {\n\t\tget types():string[] { return []; },\n\n\t\tget $slug( this:Resource ):string {\n\t\t\tif( URI.isBNodeID( this.$id ) ) return this.$id;\n\t\t\treturn URI.getSlug( this.$id );\n\t\t},\n\t\tset $slug( this:Resource, slug:string ) {},\n\n\n\t\taddType( this:Resource, type:string ):void {\n\t\t\ttype = __resolveURI( this, type );\n\n\t\t\tif( this.types.indexOf( type ) !== - 1 ) return;\n\n\t\t\tthis.types.push( type );\n\t\t},\n\n\t\thasType( this:Resource, type:string ):boolean {\n\t\t\ttype = __resolveURI( this, type );\n\t\t\treturn this.types.indexOf( type ) !== - 1;\n\t\t},\n\n\t\tremoveType( this:Resource, type:string ):void {\n\t\t\ttype = __resolveURI( this, type );\n\n\t\t\tconst index:number = this.types.indexOf( type );\n\t\t\tif( index !== - 1 ) this.types.splice( index, 1 );\n\t\t},\n\n\n\t\ttoJSON( this:Resource, contextOrKey?:Context | string ):RDFNode {\n\t\t\tconst context:Context | undefined = typeof contextOrKey === \"object\" ?\n\t\t\t\tcontextOrKey : __getContext( this.$registry );\n\n\t\t\tconst generalSchema:DigestedObjectSchema = context ?\n\t\t\t\tcontext.registry.getGeneralSchema() : new DigestedObjectSchema();\n\n\t\t\tconst resourceSchema:DigestedObjectSchema = context && context.registry ?\n\t\t\t\tcontext.registry.getSchemaFor( this ) : generalSchema;\n\n\t\t\tconst jsonldConverter:JSONLDConverter = context ?\n\t\t\t\tcontext.jsonldConverter : new JSONLDConverter();\n\n\t\t\treturn jsonldConverter.expand( this, generalSchema, resourceSchema );\n\t\t},\n\t},\n\n\tisDecorated( object:object ):object is Resource {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( Resource.PROTOTYPE, object );\n\t},\n\n\tis( value:any ):value is Resource {\n\t\treturn Pointer.is( value )\n\t\t\t&& Resource.isDecorated( value );\n\t},\n\n\tcreate<T extends object>( data?:T & BaseResource ):T & Resource {\n\t\tconst clone:T = Object.assign( {}, data );\n\t\treturn Resource.createFrom<T>( clone );\n\t},\n\n\tcreateFrom<T extends object>( object:T & BaseResource ):T & Resource {\n\t\treturn Resource.decorate<T>( object );\n\t},\n\n\tdecorate<T extends BaseResource>( object:T ):T & Resource {\n\t\tif( Resource.isDecorated( object ) ) return object;\n\n\t\tif( ! object.hasOwnProperty( \"$registry\" ) ) object.$registry = void 0;\n\n\t\tconst resource:T & RegisteredPointer = ModelDecorator\n\t\t\t.decorateMultiple( object as T & { $registry:undefined }, RegisteredPointer );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( Resource.PROTOTYPE, resource );\n\t},\n};\n"]}