{"version":3,"sources":["Apps.ts"],"names":[],"mappings":"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","file":"Apps.js","sourcesContent":["import * as App from \"./App\";\nimport AppContext from \"./App/Context\";\nimport Context from \"./Context\";\nimport * as Errors from \"./Errors\";\nimport * as HTTP from \"./HTTP\";\nimport * as NS from \"./NS\";\nimport * as PersistedApp from \"./PersistedApp\";\nimport * as PersistedDocument from \"./PersistedDocument\";\nimport * as Pointer from \"./Pointer\";\nimport * as RDF from \"./RDF\";\nimport * as SPARQL from \"./SPARQL\";\nimport * as Utils from \"./Utils\";\n\nexport class Class {\n\tprivate context:Context;\n\n\tconstructor( context:Context ) {\n\t\tthis.context = context;\n\t}\n\n\tgetContext( uri:string ):Promise<AppContext>;\n\tgetContext( pointer:Pointer.Class ):Promise<AppContext>;\n\tgetContext( pointerOrURI:any ):Promise<AppContext> {\n\t\tlet pointer:Pointer.Class = ! Utils.isString( pointerOrURI ) ? pointerOrURI : null;\n\t\tlet uri:string = ! ! pointer ? pointer.id : pointerOrURI;\n\n\t\tif( ! uri ) return Promise.reject<AppContext>( new Errors.IllegalArgumentError( \"The application's URI must be defined.\" ) );\n\n\t\treturn this.resolveURI( uri ).then( ( appURI:string ) => {\n\t\t\tpointer = this.context.documents.getPointer( appURI );\n\t\t\treturn pointer.resolve<PersistedApp.Class>();\n\n\t\t} ).then( ( [ app, response ]:[ PersistedApp.Class, HTTP.Response.Class ] ) => {\n\t\t\tif( ! PersistedApp.Factory.is( app ) ) throw new Errors.IllegalArgumentError( \"The resource fetched is not a cs:Application.\" );\n\t\t\treturn new AppContext( this.context, app );\n\t\t} );\n\n\t}\n\n\tgetAllContexts():Promise<AppContext[]> {\n\t\treturn this.resolveURI( \"\" ).then( ( appsContainerURI:string ) => {\n\t\t\tif( ! this.context.auth || ! this.context.auth.isAuthenticated() ) return this.context.documents.getMembers<PersistedApp.Class>( this.getContainerURI(), false );\n\n\t\t\tlet agentID:string = this.context.auth.authenticatedAgent.id;\n\t\t\treturn this.context.documents.executeSELECTQuery( agentID, `\n\t\t\t\tSELECT ?app WHERE {\n\t\t\t\t\t<${ agentID }> <${ NS.C.Predicate.appRoleMap }> ?roleMap.\n\t\t\t\t\t?roleMap <${ NS.C.Predicate.entry }> ?appEntry.\n\t\t\t\t\t?appEntry <${ NS.C.Predicate.key }> ?app.\n\t\t\t\t}\n\t\t\t` ).then( ( [ results, response ]:[ SPARQL.SELECTResults.Class, HTTP.Response.Class ] ) => {\n\t\t\t\tlet apps:Pointer.Class[] = results.bindings.map( binding => <Pointer.Class> binding[ \"app\" ] );\n\t\t\t\treturn <Promise<[PersistedApp.Class[], any]>> Pointer.Util.resolveAll<PersistedApp.Class>( apps );\n\t\t\t} );\n\n\t\t} ).then( ( [ apps, response ]:[ PersistedApp.Class[], any ] ) => {\n\t\t\treturn apps.map( ( app:Pointer.Class ) => new AppContext( this.context, <any> app ) );\n\t\t} );\n\t}\n\n\tcreate( appDocument:App.Class, slug:string = null ):Promise<[ PersistedDocument.Class, HTTP.Response.Class]> {\n\t\treturn this.resolveURI( \"\" ).then( ( appsContainerURI:string ) => {\n\t\t\tif( ! App.Factory.is( appDocument ) ) throw new Errors.IllegalArgumentError( \"The Document is not a `Carbon.App.Class` object.\" );\n\n\t\t\treturn this.context.documents.createChild( appsContainerURI, appDocument, slug );\n\t\t} );\n\t}\n\n\tdelete( appURI:string, requestOptions?:HTTP.Request.Options ):Promise<HTTP.Response.Class> {\n\t\tif( ! appURI ) return Promise.reject<any>( new Errors.IllegalArgumentError( \"The application's URI must be defined.\" ) );\n\n\t\treturn this.resolveURI( appURI ).then( ( uri:string ) => {\n\t\t\treturn this.context.documents.delete( uri, requestOptions );\n\t\t} );\n\t}\n\n\tprivate resolveURI( appURI:string ):Promise<string> {\n\t\treturn new Promise<string>( ( resolve:( uri:string ) => void ) => {\n\t\t\tlet containerURI:string = this.context.resolve( this.getContainerURI() );\n\t\t\tlet uri:string = RDF.URI.Util.resolve( containerURI, appURI );\n\n\t\t\tif( ! RDF.URI.Util.isBaseOf( containerURI, uri ) ) throw new Errors.IllegalArgumentError( \"The URI provided is not a valid app of the current context.\" );\n\n\t\t\tresolve( uri );\n\t\t} );\n\n\t}\n\n\tprivate getContainerURI():string {\n\t\tif( ! this.context.hasSetting( \"platform.apps.container\" ) ) throw new Errors.IllegalStateError( \"The apps container URI hasn't been set.\" );\n\t\treturn this.context.getSetting( \"platform.apps.container\" );\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}