{"version":3,"sources":["PersistedResource.ts"],"names":[],"mappings":"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","file":"PersistedResource.js","sourcesContent":["import { Resource } from \"./Resource\";\nimport * as PartialMetadata from \"./SPARQL/QueryDocument/PartialMetadata\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends Resource {\n\t_partialMetadata?:PartialMetadata.Class;\n\n\t_snapshot:Resource;\n\t_syncSnapshot:() => void;\n\n\tisDirty():boolean;\n\n\trevert():void;\n\n\n\tisPartial():boolean;\n}\n\nfunction syncSnapshot( this:Class ):void {\n\tthis._snapshot = Utils.O.clone( this, { arrays: true } );\n\n\tthis._snapshot.id = this.id;\n\tthis._snapshot.types = this.types.slice();\n}\n\nfunction isDirty():boolean {\n\tlet resource:Class & Resource = this;\n\n\tif( ! Utils.O.areEqual( resource, resource._snapshot, { arrays: true } ) ) return true;\n\n\tlet response:boolean = false;\n\tif( \"id\" in resource ) response = response || (resource._snapshot as Resource).id !== resource.id;\n\tif( \"types\" in resource ) response = response || ! Utils.O.areEqual( (resource._snapshot as Resource).types, resource.types );\n\n\treturn response;\n}\n\nfunction revert():void {\n\tlet resource:Class & Resource = this;\n\n\tfor( let key of Object.keys( resource ) ) {\n\t\tif( ! ( key in resource._snapshot ) ) delete resource[ key ];\n\t}\n\n\tUtils.O.extend( resource, resource._snapshot, { arrays: true } );\n}\n\nfunction isPartial( this:Class ):boolean {\n\treturn ! ! this._partialMetadata;\n}\n\nexport class Factory {\n\tstatic hasClassProperties( object:object ):object is Class {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_snapshot\" )\n\t\t\t&& Utils.hasFunction( object, \"_syncSnapshot\" )\n\t\t\t&& Utils.hasFunction( object, \"isDirty\" )\n\t\t\t&& Utils.hasFunction( object, \"isPartial\" )\n\t\t\t&& Utils.hasFunction( object, \"revert\" )\n\t\t);\n\t}\n\n\tstatic decorate<T extends Resource>( object:T ):T & Class {\n\t\tif( Factory.hasClassProperties( object ) ) return object;\n\n\t\tlet persistedResource:T & Class = <any> object;\n\n\t\tObject.defineProperties( persistedResource, {\n\t\t\t\"_snapshot\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: {},\n\t\t\t},\n\t\t\t\"_syncSnapshot\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: syncSnapshot,\n\t\t\t},\n\n\t\t\t\"_partialMetadata\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t},\n\n\t\t\t\"isDirty\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: isDirty,\n\t\t\t},\n\t\t\t\"revert\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: revert,\n\t\t\t},\n\n\t\t\t\"isPartial\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: isPartial,\n\t\t\t},\n\t\t} );\n\n\t\treturn persistedResource;\n\t}\n}\n\nexport default Class;\n"]}