{"version":3,"sources":["Document/TransientDocument.ts"],"names":[],"mappings":"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","file":"TransientDocument.js","sourcesContent":["import {\n\tBaseBlankNode,\n\tTransientBlankNode,\n} from \"../BlankNode\";\nimport { ModelDecorator } from \"../core/ModelDecorator\";\nimport { ModelFactory } from \"../core/ModelFactory\";\nimport {\n\tIDAlreadyInUseError,\n\tIllegalArgumentError,\n} from \"../Errors\";\nimport { TransientFragment } from \"../Fragment\";\nimport { JSONLDConverter } from \"../JSONLD\";\nimport {\n\tBaseNamedFragment,\n\tTransientNamedFragment,\n} from \"../NamedFragment\";\nimport {\n\tDigestedObjectSchema,\n\tObjectSchemaResolver,\n} from \"../ObjectSchema\";\nimport {\n\tPointer,\n\tPointerLibrary,\n\tPointerValidator,\n} from \"../Pointer\";\nimport {\n\tRDFDocument,\n\tRDFNode,\n\tURI,\n} from \"../RDF\";\nimport { TransientResource } from \"../Resource\";\nimport {\n\thasFunction,\n\thasPropertyDefined,\n\tisObject,\n\tisPlainObject,\n\tisString,\n} from \"../Utils\";\nimport { C } from \"../Vocabularies\";\nimport { BaseDocument } from \"./BaseDocument\";\n\n\nexport interface TransientDocument extends TransientResource, PointerLibrary, PointerValidator {\n\tdefaultInteractionModel?:Pointer;\n\tisMemberOfRelation?:Pointer;\n\thasMemberRelation?:Pointer;\n\n\t_fragmentsIndex:Map<string, TransientFragment>;\n\n\t_normalize():void;\n\n\n\t_removeFragment( slugOrFragment:string | TransientFragment ):void;\n\n\n\thasFragment( slug:string ):boolean;\n\n\n\tgetFragment<T>( slug:string ):T & TransientFragment;\n\n\tgetNamedFragment<T>( slug:string ):T & TransientNamedFragment;\n\n\n\tgetFragments():TransientFragment[];\n\n\n\tcreateFragment<T>( object:T, slug?:string ):T & TransientFragment;\n\n\tcreateFragment( slug?:string ):TransientFragment;\n\n\n\tcreateNamedFragment<T>( object:T, slug:string ):T & TransientNamedFragment;\n\n\tcreateNamedFragment( slug:string ):TransientNamedFragment;\n\n\n\tremoveNamedFragment( slugOrFragment:string | TransientNamedFragment ):void;\n\n\n\ttoJSON( objectSchemaResolver?:ObjectSchemaResolver, jsonldConverter?:JSONLDConverter ):RDFDocument;\n}\n\n\nexport interface TransientDocumentFactory extends ModelFactory<TransientDocument>, ModelDecorator<TransientDocument> {\n\tTYPE:C[ \"Document\" ];\n\n\n\tis( value:any ):value is TransientDocument;\n\n\tisDecorated( object:object ):object is TransientDocument;\n\n\n\tcreate<T extends object>( data?:T & BaseDocument ):T & TransientDocument;\n\n\tcreateFrom<T extends object>( object:T & BaseDocument ):T & TransientDocument;\n\n\tdecorate<T extends object>( object:T ):T & TransientDocument;\n\n\n\t_convertNestedObjects( parent:TransientDocument, actual:any, fragmentsTracker?:Set<string> ):void;\n}\n\nexport const TransientDocument:TransientDocumentFactory = {\n\tTYPE: C.Document,\n\n\tisDecorated: ( object ):object is TransientDocument =>\n\t\tisObject( object ) &&\n\t\thasPropertyDefined( object, \"_fragmentsIndex\" ) &&\n\n\t\thasFunction( object, \"_normalize\" ) &&\n\t\thasFunction( object, \"_removeFragment\" ) &&\n\n\t\thasFunction( object, \"hasPointer\" ) &&\n\t\thasFunction( object, \"getPointer\" ) &&\n\n\t\thasFunction( object, \"inScope\" ) &&\n\n\t\thasFunction( object, \"hasFragment\" ) &&\n\t\thasFunction( object, \"getFragment\" ) &&\n\t\thasFunction( object, \"getNamedFragment\" ) &&\n\t\thasFunction( object, \"getFragments\" ) &&\n\t\thasFunction( object, \"createFragment\" ) &&\n\t\thasFunction( object, \"createNamedFragment\" ) &&\n\t\thasFunction( object, \"removeNamedFragment\" ) &&\n\n\t\thasFunction( object, \"toJSON\" )\n\t,\n\n\tis: ( value ):value is TransientDocument =>\n\t\tTransientResource.is( value ) &&\n\t\tTransientDocument.isDecorated( value )\n\t,\n\n\n\tdecorate: <T extends object>( object:T ) => {\n\t\tif( TransientDocument.isDecorated( object ) ) return object;\n\n\t\tTransientResource.decorate( object );\n\n\t\tObject.defineProperties( object, {\n\t\t\t\"_fragmentsIndex\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: new Map<string, TransientFragment>(),\n\t\t\t},\n\n\t\t\t\"_normalize\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: normalize,\n\t\t\t},\n\t\t\t\"_removeFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: removeFragment,\n\t\t\t},\n\n\t\t\t\"hasPointer\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasPointer,\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getPointer,\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: inScope,\n\t\t\t},\n\n\t\t\t\"hasFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasFragment,\n\t\t\t},\n\t\t\t\"getFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getFragment,\n\t\t\t},\n\t\t\t\"getNamedFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getNamedFragment,\n\t\t\t},\n\t\t\t\"getFragments\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getFragments,\n\t\t\t},\n\t\t\t\"createFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createFragment,\n\t\t\t},\n\t\t\t\"createNamedFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createNamedFragment,\n\t\t\t},\n\t\t\t\"removeNamedFragment\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: removeNamedFragment,\n\t\t\t},\n\t\t\t\"toJSON\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: toJSON,\n\t\t\t},\n\t\t} );\n\n\t\treturn object as any;\n\t},\n\n\tcreateFrom: <T extends object>( object:T & BaseDocument ) => {\n\t\tif( TransientDocument.is( object ) ) throw new IllegalArgumentError( \"The object provided is already a Document.\" );\n\n\t\tconst document:T & TransientDocument = TransientDocument.decorate<T>( object );\n\t\tTransientDocument._convertNestedObjects( document, document );\n\n\t\treturn document;\n\t},\n\n\tcreate: <T extends object>( data?:T & BaseDocument ) => {\n\t\tconst copy:T = Object.assign( {}, data );\n\t\treturn TransientDocument.createFrom( copy );\n\t},\n\n\n\t_convertNestedObjects( parent:TransientDocument, actual:any, fragmentsTracker:Set<string> = new Set() ):void {\n\t\tfor( let key of Object.keys( actual ) ) {\n\t\t\tconst next:any = actual[ key ];\n\n\t\t\tif( Array.isArray( next ) ) {\n\t\t\t\tTransientDocument._convertNestedObjects( parent, next, fragmentsTracker );\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif( ! isPlainObject( next ) ) continue;\n\t\t\tif( TransientDocument.is( next ) ) continue;\n\n\t\t\tconst idOrSlug:string = getNestedObjectId( next );\n\t\t\tif( ! ! idOrSlug && ! inScope.call( parent, idOrSlug ) ) continue;\n\n\t\t\tconst parentFragment:TransientFragment = parent.getFragment( idOrSlug );\n\t\t\tif( ! parentFragment ) {\n\t\t\t\tconst fragment:TransientFragment = parent.createFragment( <Object> next, idOrSlug );\n\t\t\t\tTransientDocument._convertNestedObjects( parent, fragment, fragmentsTracker );\n\n\t\t\t} else if( parentFragment !== next ) {\n\t\t\t\tconst fragment:TransientFragment = actual[ key ] = Object.assign( parentFragment, next );\n\t\t\t\tTransientDocument._convertNestedObjects( parent, fragment, fragmentsTracker );\n\n\t\t\t} else if( ! fragmentsTracker.has( next.id ) ) {\n\t\t\t\tfragmentsTracker.add( next.id );\n\t\t\t\tTransientDocument._convertNestedObjects( parent, next, fragmentsTracker );\n\t\t\t}\n\n\t\t}\n\n\t},\n\n};\n\nfunction getNestedObjectId( object:any ):string {\n\tif( \"id\" in object ) return object.id;\n\n\tif( \"slug\" in object ) return URI.hasFragment( object.slug ) ?\n\t\tobject.slug : \"#\" + object.slug;\n\n\treturn \"\";\n}\n\n\nfunction hasPointer( this:TransientDocument, id:string ):boolean {\n\tif( id === this.id ) return true;\n\tif( ! this.inScope( id ) ) return false;\n\n\treturn this.hasFragment( id );\n}\n\nfunction getPointer( this:TransientDocument, id:string ):Pointer {\n\tif( ! this.inScope( id ) ) return null;\n\tif( id === this.id ) return this;\n\n\treturn this.hasFragment( id ) ?\n\t\tthis.getFragment( id ) :\n\t\tthis.createFragment( id );\n}\n\nfunction inScope( this:TransientDocument, idOrPointer:string | Pointer ):boolean {\n\tconst id:string = isString( idOrPointer ) ? idOrPointer : idOrPointer.id;\n\n\tif( id === this.id ) return true;\n\tif( URI.isBNodeID( id ) ) return true;\n\tif( URI.isFragmentOf( id, this.id ) ) return true;\n\treturn id.startsWith( \"#\" );\n}\n\nfunction hasFragment( this:TransientDocument, id:string ):boolean {\n\tif( URI.isAbsolute( id ) ) {\n\t\tif( ! URI.isFragmentOf( id, this.id ) ) return false;\n\t\tid = URI.hasFragment( id ) ? URI.getFragment( id ) : id;\n\t} else if( id.startsWith( \"#\" ) ) {\n\t\tid = id.substring( 1 );\n\t}\n\n\treturn this._fragmentsIndex.has( id );\n}\n\nfunction getFragment( this:TransientDocument, id:string ):TransientFragment {\n\tif( ! URI.isBNodeID( id ) ) return this.getNamedFragment( id );\n\treturn this._fragmentsIndex.get( id ) || null;\n}\n\nfunction getNamedFragment( this:TransientDocument, id:string ):TransientNamedFragment {\n\tif( URI.isBNodeID( id ) ) throw new IllegalArgumentError( \"Named fragments can't have a id that starts with '_:'.\" );\n\tif( URI.isAbsolute( id ) ) {\n\t\tif( ! URI.isFragmentOf( id, this.id ) ) throw new IllegalArgumentError( \"The id is out of scope.\" );\n\t\tid = URI.hasFragment( id ) ? URI.getFragment( id ) : id;\n\t} else if( id.startsWith( \"#\" ) ) {\n\t\tid = id.substring( 1 );\n\t}\n\n\treturn <TransientNamedFragment> this._fragmentsIndex.get( id ) || null;\n}\n\nfunction getFragments( this:TransientDocument ):TransientFragment[] {\n\treturn Array.from( this._fragmentsIndex.values() );\n}\n\nfunction createFragment<T extends object>( object:T, slug?:string ):T & TransientFragment;\nfunction createFragment( slug?:string ):TransientFragment;\nfunction createFragment<T extends object>( this:TransientDocument, slugOrObject?:any, slug?:string ):T & TransientFragment {\n\tslug = isString( slugOrObject ) ? slugOrObject : slug;\n\tconst object:T = ! isString( slugOrObject ) && ! ! slugOrObject ? slugOrObject : <T> {};\n\n\tif( slug ) {\n\t\tif( ! URI.isBNodeID( slug ) ) return this.createNamedFragment<T>( object, slug );\n\t\tif( this._fragmentsIndex.has( slug ) ) throw new IDAlreadyInUseError( \"The slug provided is already being used by a fragment.\" );\n\t}\n\n\tconst baseBNode:T & BaseBlankNode = Object.assign( object, {\n\t\t_document: this,\n\t\tid: slug,\n\t} );\n\tconst fragment:T & TransientBlankNode = TransientBlankNode.createFrom( baseBNode );\n\tthis._fragmentsIndex.set( fragment.id, fragment );\n\n\tTransientDocument._convertNestedObjects( this, fragment );\n\treturn fragment;\n}\n\nfunction createNamedFragment<T extends Object>( object:T, slug:string ):TransientNamedFragment & T;\nfunction createNamedFragment( slug:string ):TransientNamedFragment;\nfunction createNamedFragment<T extends Object>( this:TransientDocument, slugOrObject:any, slug?:string ):T & TransientNamedFragment {\n\tslug = isString( slugOrObject ) ? slugOrObject : slug;\n\tconst object:T = ! isString( slugOrObject ) && ! ! slugOrObject ? slugOrObject : <T> {};\n\n\tif( URI.isBNodeID( slug ) ) throw new IllegalArgumentError( \"Named fragments can't have a slug that starts with '_:'.\" );\n\n\tif( URI.isAbsolute( slug ) ) {\n\t\tif( ! URI.isFragmentOf( slug, this.id ) ) throw new IllegalArgumentError( \"The slug is out of scope.\" );\n\t\tslug = URI.hasFragment( slug ) ? URI.getFragment( slug ) : slug;\n\t} else if( slug.startsWith( \"#\" ) ) slug = slug.substring( 1 );\n\n\tif( this._fragmentsIndex.has( slug ) ) throw new IDAlreadyInUseError( \"The slug provided is already being used by a fragment.\" );\n\n\tconst baseFragment:T & BaseNamedFragment = Object.assign( object, {\n\t\t_document: this,\n\t\tslug,\n\t} );\n\tconst fragment:T & TransientNamedFragment = TransientNamedFragment.createFrom( baseFragment );\n\tthis._fragmentsIndex.set( slug, fragment );\n\n\tTransientDocument._convertNestedObjects( this, fragment );\n\treturn fragment;\n}\n\nfunction removeFragment( this:TransientDocument, fragmentOrSlug:string | TransientFragment ):void {\n\tlet id:string = isString( fragmentOrSlug ) ? fragmentOrSlug : fragmentOrSlug.id;\n\n\tif( URI.isAbsolute( id ) ) {\n\t\tif( ! URI.isFragmentOf( id, this.id ) ) return;\n\t\tid = URI.hasFragment( id ) ? URI.getFragment( id ) : id;\n\t} else if( id.startsWith( \"#\" ) ) {\n\t\tid = id.substring( 1 );\n\t}\n\n\tthis._fragmentsIndex.delete( id );\n}\n\nfunction removeNamedFragment( this:TransientDocument, fragmentOrSlug:TransientNamedFragment | string ):void {\n\tconst id:string = isString( fragmentOrSlug ) ? fragmentOrSlug : fragmentOrSlug.id;\n\n\tif( URI.isBNodeID( id ) ) throw new IllegalArgumentError( \"You can only remove NamedFragments.\" );\n\tthis._removeFragment( id );\n}\n\nfunction toJSON( this:TransientDocument, keyOrObjectSchemaResolver?:string | ObjectSchemaResolver, jsonldConverter:JSONLDConverter = new JSONLDConverter() ):RDFDocument {\n\tconst objectSchemaResolver:ObjectSchemaResolver = isObject( keyOrObjectSchemaResolver ) ?\n\t\tkeyOrObjectSchemaResolver : null;\n\tconst generalSchema:DigestedObjectSchema = objectSchemaResolver ?\n\t\tobjectSchemaResolver.getGeneralSchema() : new DigestedObjectSchema();\n\n\tconst resources:object[] = [ this, ...this.getFragments() ];\n\tconst expandedResources:RDFNode[] = resources.map( resource => {\n\t\tconst resourceSchema:DigestedObjectSchema = objectSchemaResolver ? objectSchemaResolver.getSchemaFor( resource ) : new DigestedObjectSchema();\n\t\treturn jsonldConverter.expand( resource, generalSchema, resourceSchema );\n\t} );\n\n\treturn {\n\t\t\"@id\": this.id,\n\t\t\"@graph\": expandedResources,\n\t};\n}\n\nfunction normalize( this:TransientDocument ):void {\n\tconst currentFragments:TransientFragment[] = this.getFragments()\n\t\t.filter( fragment => URI.isBNodeID( fragment.id ) );\n\tconst usedFragmentsIDs:Set<string> = new Set();\n\n\tTransientDocument._convertNestedObjects( this, this, usedFragmentsIDs );\n\tcurrentFragments.forEach( fragment => {\n\t\tif( usedFragmentsIDs.has( fragment.id ) ) return;\n\t\tthis._fragmentsIndex.delete( fragment.id );\n\t} );\n}\n"]}