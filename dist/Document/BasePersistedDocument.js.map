{"version":3,"sources":["Document/BasePersistedDocument.ts"],"names":[],"mappings":";;AACA,gCAAyC;AACzC,wCAAuC;AAGvC,wCAAgD;AAChD,kCAGkB;AAElB,yDAAwD;AAoBxD,IAAM,SAAS,GAA+E;IAC7F,SAAS,EAAE,KAAK;IAChB,KAAK,EAAE,KAAK,CAAC;IAEb,IAAI,eAAe,KAAgB,OAAO,EAAE,CAAC,CAAC,CAAC;IAG/C,UAAU,EAAV;QACC,OAAO,CAAE,CAAE,IAAI,CAAC,SAAS,CAAC;IAC3B,CAAC;IAED,UAAU,EAAV;QACC,OAAO,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC;IAC5B,CAAC;IAGD,mBAAmB,EAAnB;QACC,IAAI,CAAC,eAAe,GAAG,KAAK;aAC1B,IAAI,CAAE,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAE;aACnC,GAAG,CAAE,mBAAQ,CAAC,QAAQ,CAAE,CACzB;QAED,IAAI,CAAC,eAAe;aAClB,OAAO,CAAE,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,aAAa,EAAE,EAAxB,CAAwB,CAAE,CAChD;IACF,CAAC;CACD,CAAC;AAcW,QAAA,qBAAqB,GAAgC;IACjE,SAAS,WAAA;IAET,WAAW,EAAX,UAAa,MAAa;QACzB,OAAO,gBAAQ,CAAE,MAAM,CAAE;eACrB,qBAAc;iBACf,iBAAiB,CAAE,SAAS,EAAE,MAAM,CAAE,CACvC;IACH,CAAC;IAED,QAAQ,EAAR,UAA4B,MAAQ;QACnC,IAAI,6BAAqB,CAAC,WAAW,CAAE,MAAM,CAAE;YAAG,OAAO,MAAM,CAAC;QAEhE,IAAM,QAAQ,GAA6C,qBAAc;aACvE,gBAAgB,CAAE,MAAM,EAAE,qCAAiB,EAAE,4BAAiB,CAAE,CAAC;QAEnE,OAAO,qBAAc;aACnB,oBAAoB,CAAE,SAAS,EAAE,QAAQ,CAAE,CAAC;IAC/C,CAAC;IAGD,EAAE,EAAF,UAAI,KAAS;QACZ,OAAO,qCAAiB,CAAC,EAAE,CAAE,KAAK,CAAE;eAChC,4BAAiB,CAAC,WAAW,CAAE,KAAK,CAAE;eACtC,6BAAqB,CAAC,WAAW,CAAE,KAAK,CAAE,CAC5C;IACH,CAAC;CACD,CAAC","file":"BasePersistedDocument.js","sourcesContent":["import { BlankNode } from \"../BlankNode\";\nimport { ModelDecorator } from \"../core\";\nimport { Fragment } from \"../Fragment\";\nimport { NamedFragment } from \"../NamedFragment\";\nimport { DocumentsRegistry } from \"../Registry\";\nimport { PersistedResource } from \"../Resource\";\nimport {\n\tisObject,\n\tPickSelfProps\n} from \"../Utils\";\nimport { Document } from \"./Document\";\nimport { TransientDocument } from \"./TransientDocument\";\n\n\nexport interface BasePersistedDocument extends TransientDocument, PersistedResource {\n\t_registry:DocumentsRegistry | undefined;\n\n\t_resolved:boolean | undefined;\n\t_eTag:string | undefined | null;\n\n\t_savedFragments:(BlankNode | NamedFragment)[];\n\n\n\tisResolved():boolean;\n\tisOutdated():boolean;\n\n\n\t_syncSavedFragments():void;\n}\n\n\nconst PROTOTYPE:PickSelfProps<BasePersistedDocument, TransientDocument & PersistedResource> = {\n\t_resolved: false,\n\t_eTag: void 0,\n\n\tget _savedFragments():Fragment[] { return []; },\n\n\n\tisResolved( this:BasePersistedDocument ):boolean {\n\t\treturn ! ! this._resolved;\n\t},\n\n\tisOutdated( this:BasePersistedDocument ):boolean {\n\t\treturn this._eTag === null;\n\t},\n\n\n\t_syncSavedFragments( this:Document ):void {\n\t\tthis._savedFragments = Array\n\t\t\t.from( this._resourcesMap.values() )\n\t\t\t.map( Fragment.decorate )\n\t\t;\n\n\t\tthis._savedFragments\n\t\t\t.forEach( fragment => fragment._syncSnapshot() )\n\t\t;\n\t},\n};\n\nexport interface BasePersistedDocumentFactory {\n\tPROTOTYPE:PickSelfProps<BasePersistedDocument, TransientDocument & PersistedResource>;\n\n\n\tisDecorated( object:object ):object is BasePersistedDocument;\n\n\tdecorate<T extends object>( object:T ):T & BasePersistedDocument;\n\n\n\tis( value:any ):value is BasePersistedDocument;\n}\n\nexport const BasePersistedDocument:BasePersistedDocumentFactory = {\n\tPROTOTYPE,\n\n\tisDecorated( object:object ):object is BasePersistedDocument {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends object>( object:T ):T & BasePersistedDocument {\n\t\tif( BasePersistedDocument.isDecorated( object ) ) return object;\n\n\t\tconst resource:T & TransientDocument & PersistedResource = ModelDecorator\n\t\t\t.decorateMultiple( object, TransientDocument, PersistedResource );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( PROTOTYPE, resource );\n\t},\n\n\n\tis( value:any ):value is BasePersistedDocument {\n\t\treturn TransientDocument.is( value )\n\t\t\t&& PersistedResource.isDecorated( value )\n\t\t\t&& BasePersistedDocument.isDecorated( value )\n\t\t\t;\n\t},\n};\n"]}