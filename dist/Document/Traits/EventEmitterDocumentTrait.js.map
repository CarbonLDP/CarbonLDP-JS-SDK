{"version":3,"sources":["Document/Traits/EventEmitterDocumentTrait.ts"],"names":[],"mappings":"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","file":"EventEmitterDocumentTrait.js","sourcesContent":["import { EventEmitterDocumentsRepositoryTrait } from \"../../DocumentsRepository/Traits/EventEmitterDocumentsRepositoryTrait\";\nimport { ChildCreated } from \"../../Messaging/ChildCreated\";\nimport { DocumentDeleted } from \"../../Messaging/DocumentDeleted\";\nimport { DocumentModified } from \"../../Messaging/DocumentModified\";\nimport { Event } from \"../../Messaging/Event\";\nimport { EventMessage } from \"../../Messaging/EventMessage\";\nimport { MemberAdded } from \"../../Messaging/MemberAdded\";\nimport { MemberRemoved } from \"../../Messaging/MemberRemoved\";\n\nimport { ModelDecorator } from \"../../Model/ModelDecorator\";\nimport { ModelPrototype } from \"../../Model/ModelPrototype\";\n\nimport { Pointer } from \"../../Pointer/Pointer\";\n\nimport { URI } from \"../../RDF/URI\";\nimport { ResolvablePointer } from \"../../Repository/ResolvablePointer\";\n\nimport { isFunction, isObject, isString } from \"../../Utils\";\n\nimport { TransientDocument } from \"../TransientDocument\";\n\n\nexport interface BaseEventEmitterDocumentTrait {\n\t$repository:EventEmitterDocumentsRepositoryTrait;\n}\n\nexport interface EventEmitterDocumentTrait extends TransientDocument, ResolvablePointer {\n\t$repository:EventEmitterDocumentsRepositoryTrait;\n\n\ton( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.CHILD_CREATED, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_MODIFIED, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_DELETED, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_ADDED, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_REMOVED, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event | string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\toff( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.CHILD_CREATED, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_MODIFIED, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_DELETED, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_ADDED, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_REMOVED, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event | string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\tone( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.CHILD_CREATED, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_MODIFIED, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_DELETED, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_ADDED, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_REMOVED, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event | string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\n\tonChildCreated( uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\tonChildCreated( onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\n\tonDocumentModified( uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\tonDocumentModified( onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\n\tonDocumentDeleted( uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\tonDocumentDeleted( onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\n\tonMemberAdded( uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\tonMemberAdded( onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\n\tonMemberRemoved( uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\tonMemberRemoved( onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n}\n\n\ntype OnEvent<T extends EventMessage> = ( message:EventMessage ) => void;\ntype OnError = ( error:Error ) => void;\n\nfunction __parseParams<T extends EventMessage>( resource:Pointer, uriPatternOROnEvent:string | OnEvent<T>, onEventOrOnError:OnEvent<T> | OnError, onError:OnError | undefined ):{ uriPattern:string, onEvent:OnEvent<T>, onError:OnError | undefined } {\n\tconst uriPattern:string = isString( uriPatternOROnEvent ) ?\n\t\tURI.resolve( resource.$id, uriPatternOROnEvent ) : resource.$id;\n\n\tconst onEvent:OnEvent<T> = isFunction( uriPatternOROnEvent ) ?\n\t\turiPatternOROnEvent : onEventOrOnError as OnEvent<T>;\n\n\tif( onEvent !== onEventOrOnError ) onError = onEventOrOnError as OnError;\n\n\treturn { uriPattern, onEvent, onError };\n}\n\n\nexport type EventEmitterDocumentTraitFactory =\n\t& ModelPrototype<EventEmitterDocumentTrait, TransientDocument & ResolvablePointer>\n\t& ModelDecorator<EventEmitterDocumentTrait, BaseEventEmitterDocumentTrait>\n\t;\n\nexport const EventEmitterDocumentTrait:EventEmitterDocumentTraitFactory = {\n\tPROTOTYPE: {\n\t\ton<T extends EventMessage>( this:EventEmitterDocumentTrait, event:Event | string, uriPatternOROnEvent:string | OnEvent<T>, onEventOrOnError:OnEvent<T> | OnError, onError?:OnError ):void {\n\t\t\tconst { uriPattern, onEvent, onError: $onError } = __parseParams( this, uriPatternOROnEvent, onEventOrOnError, onError );\n\t\t\treturn this.$repository.on( event, uriPattern, onEvent, $onError );\n\t\t},\n\n\t\toff<T extends EventMessage>( this:EventEmitterDocumentTrait, event:Event | string, uriPatternOROnEvent:string | OnEvent<T>, onEventOrOnError:OnEvent<T> | OnError, onError?:OnError ):void {\n\t\t\tconst { uriPattern, onEvent, onError: $onError } = __parseParams( this, uriPatternOROnEvent, onEventOrOnError, onError );\n\t\t\treturn this.$repository.off( event, uriPattern, onEvent, $onError );\n\t\t},\n\n\t\tone<T extends EventMessage>( this:EventEmitterDocumentTrait, event:Event | string, uriPatternOROnEvent:string | OnEvent<T>, onEventOrOnError:OnEvent<T> | OnError, onError?:OnError ):void {\n\t\t\tconst { uriPattern, onEvent, onError: $onError } = __parseParams( this, uriPatternOROnEvent, onEventOrOnError, onError );\n\t\t\treturn this.$repository.one( event, uriPattern, onEvent, $onError );\n\t\t},\n\n\n\t\tonChildCreated( this:EventEmitterDocumentTrait, uriPatternOROnEvent:string | OnEvent<ChildCreated>, onEventOrOnError:OnEvent<ChildCreated> | OnError, onError?:OnError ):void {\n\t\t\treturn this.on( Event.CHILD_CREATED, uriPatternOROnEvent as string, onEventOrOnError as OnEvent<ChildCreated>, onError );\n\t\t},\n\n\t\tonDocumentModified( this:EventEmitterDocumentTrait, uriPatternOROnEvent:string | OnEvent<DocumentModified>, onEventOrOnError:OnEvent<DocumentModified> | OnError, onError?:OnError ):void {\n\t\t\treturn this.on( Event.DOCUMENT_MODIFIED, uriPatternOROnEvent as string, onEventOrOnError as OnEvent<DocumentModified>, onError );\n\t\t},\n\n\t\tonDocumentDeleted( this:EventEmitterDocumentTrait, uriPatternOROnEvent:string | OnEvent<DocumentDeleted>, onEventOrOnError:OnEvent<DocumentDeleted> | OnError, onError?:OnError ):void {\n\t\t\treturn this.on( Event.DOCUMENT_DELETED, uriPatternOROnEvent as string, onEventOrOnError as OnEvent<DocumentDeleted>, onError );\n\t\t},\n\n\t\tonMemberAdded( this:EventEmitterDocumentTrait, uriPatternOROnEvent:string | OnEvent<MemberAdded>, onEventOrOnError:OnEvent<MemberAdded> | OnError, onError?:OnError ):void {\n\t\t\treturn this.on( Event.MEMBER_ADDED, uriPatternOROnEvent as string, onEventOrOnError as OnEvent<MemberAdded>, onError );\n\t\t},\n\n\t\tonMemberRemoved( this:EventEmitterDocumentTrait, uriPatternOROnEvent:string | OnEvent<MemberRemoved>, onEventOrOnError:OnEvent<MemberRemoved> | OnError, onError?:OnError ):void {\n\t\t\treturn this.on( Event.MEMBER_REMOVED, uriPatternOROnEvent as string, onEventOrOnError as OnEvent<MemberRemoved>, onError );\n\t\t},\n\t},\n\n\n\tisDecorated( object:object ):object is EventEmitterDocumentTrait {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( EventEmitterDocumentTrait.PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends BaseEventEmitterDocumentTrait>( object:T ):T & EventEmitterDocumentTrait {\n\t\tif( EventEmitterDocumentTrait.isDecorated( object ) ) return object;\n\n\t\tconst resource:T & TransientDocument & ResolvablePointer = ModelDecorator\n\t\t\t.decorateMultiple( object, TransientDocument, ResolvablePointer );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( EventEmitterDocumentTrait.PROTOTYPE, resource );\n\t},\n};\n"]}