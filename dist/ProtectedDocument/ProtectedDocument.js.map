{"version":3,"sources":["ProtectedDocument/ProtectedDocument.ts"],"names":[],"mappings":"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","file":"ProtectedDocument.js","sourcesContent":["import {\n\tACL,\n\tCompleteACReport,\n\tDetailedUserACReport,\n\tSimpleUserACReport\n} from \"../Auth\";\nimport { ModelDecorator } from \"../core/ModelDecorator\";\nimport { ModelFactory } from \"../core/ModelFactory\";\nimport { ModelSchema } from \"../core/ModelSchema\";\nimport { Document } from \"../Document\";\nimport { Documents } from \"../Documents\";\nimport {\n\tRequestOptions,\n\tRequestService,\n\tRequestUtils,\n\tResponse\n} from \"../HTTP\";\nimport { BadResponseError } from \"../HTTP/Errors/ServerErrors\";\nimport { JSONLDParser } from \"../JSONLD\";\nimport { ObjectSchema } from \"../ObjectSchema\";\nimport { Pointer } from \"../Pointer\";\nimport {\n\tRDFNode,\n\tURI\n} from \"../RDF\";\nimport { TransientResource } from \"../Resource\";\nimport * as Utils from \"../Utils\";\nimport {\n\tisObject,\n\tisString\n} from \"../Utils\";\nimport {\n\tC,\n\tCS,\n\tLDP\n} from \"../Vocabularies\";\nimport {\n\tTransientProtectedDocument,\n\tTransientProtectedDocumentFactory,\n} from \"./TransientProtectedDocument\";\n\n\nexport interface ProtectedDocument extends Document {\n\taccessControlList?:Pointer;\n\n\tcreator?:Pointer;\n\towners?:Pointer;\n\n\n\tgetACL( requestOptions?:RequestOptions ):Promise<ACL>;\n\n\n\tgetSimpleUserACReport( requestOptions?:RequestOptions ):Promise<SimpleUserACReport>;\n\tgetSimpleUserACReport( uri:string, requestOptions?:RequestOptions ):Promise<SimpleUserACReport>;\n\n\tgetDetailedUserACReport( requestOptions?:RequestOptions ):Promise<DetailedUserACReport>;\n\tgetDetailedUserACReport( uri:string, requestOptions?:RequestOptions ):Promise<DetailedUserACReport>;\n\n\tgetCompleteACReport( requestOptions?:RequestOptions ):Promise<CompleteACReport>;\n\tgetCompleteACReport( uri:string, requestOptions?:RequestOptions ):Promise<CompleteACReport>;\n}\n\n\nexport interface ProtectedDocumentFactory extends ModelDecorator<ProtectedDocument>, TransientProtectedDocumentFactory {\n\tSCHEMA:ObjectSchema;\n\n\n\tisDecorated( object:object ):object is ProtectedDocument;\n\n\tis( object:object ):object is ProtectedDocument;\n\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & ProtectedDocument;\n}\n\nexport const ProtectedDocument:ProtectedDocumentFactory = {\n\tTYPE: TransientProtectedDocument.TYPE,\n\tSCHEMA: {\n\t\t\"accessControlList\": {\n\t\t\t\"@id\": CS.accessControlList,\n\t\t\t\"@type\": \"@id\",\n\t\t},\n\t\t\"creator\": {\n\t\t\t\"@id\": CS.creator,\n\t\t\t\"@type\": \"@id\",\n\t\t},\n\t\t\"owners\": {\n\t\t\t\"@id\": CS.owner,\n\t\t\t\"@type\": \"@id\",\n\t\t\t\"@container\": \"@set\",\n\t\t},\n\t},\n\n\tisDecorated( object:object ):object is ProtectedDocument {\n\t\treturn Utils.isObject( object )\n\t\t\t&& Utils.hasFunction( object, \"getACL\" )\n\t\t\t;\n\t},\n\n\tis( object:object ):object is ProtectedDocument {\n\t\treturn ProtectedDocument.isDecorated( object )\n\t\t\t&& Document.is( object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & ProtectedDocument {\n\t\tif( ProtectedDocument.isDecorated( object ) ) return object;\n\n\t\tDocument.decorate( object, documents );\n\n\t\tconst persistedProtectedDocument:T & ProtectedDocument = object as T & ProtectedDocument;\n\t\tObject.defineProperties( persistedProtectedDocument, {\n\t\t\t\"getACL\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getACL,\n\t\t\t},\n\n\t\t\t\"getSimpleUserACReport\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getSimpleUserACReport,\n\t\t\t},\n\t\t\t\"getDetailedUserACReport\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getDetailedUserACReport,\n\t\t\t},\n\t\t\t\"getCompleteACReport\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getCompleteACReport,\n\t\t\t},\n\t\t} );\n\n\t\treturn persistedProtectedDocument;\n\t},\n};\n\n\nfunction getACL( this:ProtectedDocument, requestOptions:RequestOptions ):Promise<ACL> {\n\tif( this.accessControlList ) return this._documents.get( this.accessControlList.id, requestOptions );\n\n\treturn this.resolve( _ => _\n\t\t.withType( CS.ProtectedDocument )\n\t\t.properties( {\n\t\t\taccessControlList: {\n\t\t\t\t\"query\": __ => __\n\t\t\t\t\t.properties( __.full ),\n\t\t\t},\n\t\t} )\n\t).then( () => {\n\t\treturn this.accessControlList as ACL;\n\t} );\n}\n\n\nfunction addDefaultRequestOptions( this:void, documents:Documents, requestOptions:RequestOptions ):void {\n\tif( documents[ \"context\" ] && documents[ \"context\" ].auth )\n\t\tdocuments[ \"context\" ].auth.addAuthentication( requestOptions );\n\n\tRequestUtils.setAcceptHeader( \"application/ld+json\", requestOptions );\n\tRequestUtils.setRetrievalPreferences( { include: [ C.PreferMinimalDocument ] }, requestOptions );\n\tRequestUtils.setPreferredInteractionModel( LDP.RDFSource, requestOptions );\n}\n\nfunction parseParams( this:void, resource:Pointer, uriOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):{ url:string, options:RequestOptions } {\n\tconst uri:string | undefined = isString( uriOrOptions ) ? uriOrOptions : void 0;\n\tconst url:string = uri ? URI.resolve( resource.id, uri ) : resource.id;\n\n\tconst options:RequestOptions = isObject( uriOrOptions ) ? uriOrOptions :\n\t\trequestOptions ? requestOptions : {};\n\n\treturn { url, options };\n}\n\nfunction makeMinimalGET( this:void, documents:Documents, url:string, options:RequestOptions ):Promise<[ object[], Response ]> {\n\taddDefaultRequestOptions( documents, options );\n\n\treturn RequestService\n\t\t.get( url, options, new JSONLDParser() )\n\t\t.catch( error => documents._parseErrorResponse( error ) )\n\t\t;\n}\n\nfunction getReport<T extends TransientResource>( this:void, reportFactory:ModelSchema & Pick<ModelFactory<T>, \"is\">, documents:Documents, rdfData:object[], response:Response ):T {\n\tconst freeNodes:RDFNode[] = RDFNode.getFreeNodes( rdfData );\n\n\tconst acReport:T | undefined = documents\n\t\t._getFreeResources( freeNodes )\n\t\t.getResources()\n\t\t.find<T>( reportFactory.is )\n\t;\n\n\tif( ! acReport )\n\t\tthrow new BadResponseError( `Expecting a ${ reportFactory.TYPE }, none has returned.`, response );\n\n\treturn acReport;\n}\n\nfunction getSimpleUserACReport( this:ProtectedDocument, uriOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<SimpleUserACReport> {\n\tconst { url, options } = parseParams( this, uriOrOptions, requestOptions );\n\n\tRequestUtils.setRetrievalPreferences( { include: [ CS.PreferSimpleUserACReport ] }, options );\n\n\treturn makeMinimalGET( this._documents, url, options )\n\t\t.then( ( [ rdfData, response ] ) => getReport( SimpleUserACReport, this._documents, rdfData, response ) )\n\t\t;\n}\n\nfunction getDetailedUserACReport( this:ProtectedDocument, uriOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<DetailedUserACReport> {\n\tconst { url, options } = parseParams( this, uriOrOptions, requestOptions );\n\n\tRequestUtils.setRetrievalPreferences( { include: [ CS.PreferDetailedUserACReport ] }, options );\n\n\treturn makeMinimalGET( this._documents, url, options )\n\t\t.then( ( [ rdfData, response ] ) => getReport( DetailedUserACReport, this._documents, rdfData, response ) )\n\t\t;\n}\n\nfunction getCompleteACReport( this:ProtectedDocument, uriOrOptions?:string | RequestOptions, requestOptions?:RequestOptions ):Promise<CompleteACReport> {\n\tconst { url, options } = parseParams( this, uriOrOptions, requestOptions );\n\n\tRequestUtils.setRetrievalPreferences( { include: [ CS.PreferCompleteACReport ] }, options );\n\n\treturn makeMinimalGET( this._documents, url, options )\n\t\t.then( ( [ rdfData, response ] ) => getReport( CompleteACReport, this._documents, rdfData, response ) )\n\t\t;\n}\n"]}