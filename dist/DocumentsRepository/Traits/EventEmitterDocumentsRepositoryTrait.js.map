{"version":3,"sources":["DocumentsRepository/Traits/EventEmitterDocumentsRepositoryTrait.ts"],"names":[],"mappings":";;AAIA,+EAA8E;AAK9E,+CAA8C;AAI9C,+CAA2D;AAE3D,6DAA4D;AAG5D,qCAAuC;AA8C1B,QAAA,oCAAoC,GAA+C;IAC/F,SAAS,EAAE;QACV,EAAE,EAAF,UAAuE,KAAoB,EAAE,UAAiB,EAAE,OAAkB,EAAE,OAAgB;YACnJ,IAAI,CAAC;gBACJ,IAAM,WAAW,GAAU,0BAAkB,CAAE,KAAK,EAAE,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAE,CAAC;gBAC1F,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAE,WAAW,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;YAEpE,CAAC;YAAC,KAAK,CAAA,CAAE,KAAM,CAAC,CAAC,CAAC;gBACjB,EAAE,CAAA,CAAE,CAAE,OAAQ,CAAC;oBAAC,MAAM,KAAK,CAAC;gBAC5B,OAAO,CAAE,KAAK,CAAE,CAAC;YAClB,CAAC;QACF,CAAC;QAED,GAAG,EAAH,UAAwE,KAAoB,EAAE,UAAiB,EAAE,OAAkB,EAAE,OAAgB;YACpJ,IAAI,CAAC;gBACJ,IAAM,WAAW,GAAU,0BAAkB,CAAE,KAAK,EAAE,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAE,CAAC;gBAC1F,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,CAAE,WAAW,EAAE,OAAO,CAAE,CAAC;YAE7D,CAAC;YAAC,KAAK,CAAA,CAAE,KAAM,CAAC,CAAC,CAAC;gBACjB,EAAE,CAAA,CAAE,CAAE,OAAQ,CAAC;oBAAC,MAAM,KAAK,CAAC;gBAC5B,OAAO,CAAE,KAAK,CAAE,CAAC;YAClB,CAAC;QACF,CAAC;QAED,GAAG,EAAH,UAAwE,KAAoB,EAAE,UAAiB,EAAE,OAAkB,EAAE,OAAgB;YAArJ,iBAeC;YAdA,IAAI,CAAC;gBACJ,IAAM,aAAW,GAAU,0BAAkB,CAAE,KAAK,EAAE,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAE,CAAC;gBAE1F,IAAM,gBAAc,GAAc,UAAA,OAAO;oBACxC,OAAO,CAAE,OAAO,CAAE,CAAC;oBACnB,KAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,CAAE,aAAW,EAAE,gBAAc,CAAE,CAAC;gBACpE,CAAC,CAAC;gBAEF,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAE,aAAW,EAAE,gBAAc,EAAE,OAAO,CAAE,CAAC;YAE3E,CAAC;YAAC,KAAK,CAAA,CAAE,KAAM,CAAC,CAAC,CAAC;gBACjB,EAAE,CAAA,CAAE,CAAE,OAAQ,CAAC;oBAAC,MAAM,KAAK,CAAC;gBAC5B,OAAO,CAAE,KAAK,CAAE,CAAC;YAClB,CAAC;QACF,CAAC;QAGD,cAAc,EAAd,UAA2D,UAAiB,EAAE,OAA6B,EAAE,OAAgB;YAC5H,MAAM,CAAC,IAAI,CAAC,EAAE,CAAE,aAAK,CAAC,aAAa,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;QACrE,CAAC;QAED,kBAAkB,EAAlB,UAA+D,UAAiB,EAAE,OAAiC,EAAE,OAAgB;YACpI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAE,aAAK,CAAC,iBAAiB,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;QACzE,CAAC;QAED,iBAAiB,EAAjB,UAA8D,UAAiB,EAAE,OAAgC,EAAE,OAAgB;YAClI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAE,aAAK,CAAC,gBAAgB,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;QACxE,CAAC;QAED,aAAa,EAAb,UAA0D,UAAiB,EAAE,OAA4B,EAAE,OAAgB;YAC1H,MAAM,CAAC,IAAI,CAAC,EAAE,CAAE,aAAK,CAAC,YAAY,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;QACpE,CAAC;QAED,eAAe,EAAf,UAA4D,UAAiB,EAAE,OAA8B,EAAE,OAAgB;YAC9H,MAAM,CAAC,IAAI,CAAC,EAAE,CAAE,aAAK,CAAC,cAAc,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,CAAE,CAAC;QACtE,CAAC;KACD;IAGD,WAAW,EAAX,UAAa,MAAa;QACzB,MAAM,CAAC,gBAAQ,CAAE,MAAM,CAAE;eACrB,+BAAc;iBACf,iBAAiB,CAAE,4CAAoC,CAAC,SAAS,EAAE,MAAM,CAAE,CAC5E;IACH,CAAC;IAED,QAAQ,EAAR,UAA6C,MAAQ;QACpD,EAAE,CAAA,CAAE,4CAAoC,CAAC,WAAW,CAAE,MAAM,CAAG,CAAC;YAAC,MAAM,CAAC,MAAM,CAAC;QAE/E,IAAM,QAAQ,GAAmC,+BAAc;aAC7D,gBAAgB,CAAE,MAAM,EAAE,qCAAiB,CAAE,CAAC;QAEhD,MAAM,CAAC,+BAAc;aACnB,oBAAoB,CAAE,4CAAoC,CAAC,SAAS,EAAE,QAAQ,CAAE,CAAC;IACpF,CAAC;CACD,CAAC","file":"EventEmitterDocumentsRepositoryTrait.js","sourcesContent":["import { DocumentsContext } from \"../../Context/DocumentsContext\";\n\nimport { Document } from \"../../Document/Document\";\n\nimport { GeneralRepository } from \"../../GeneralRepository/GeneralRepository\";\n\nimport { ChildCreated } from \"../../Messaging/ChildCreated\";\nimport { DocumentDeleted } from \"../../Messaging/DocumentDeleted\";\nimport { DocumentModified } from \"../../Messaging/DocumentModified\";\nimport { Event } from \"../../Messaging/Event\";\nimport { EventMessage } from \"../../Messaging/EventMessage\";\nimport { MemberAdded } from \"../../Messaging/MemberAdded\";\nimport { MemberRemoved } from \"../../Messaging/MemberRemoved\";\nimport { _createDestination } from \"../../Messaging/Utils\";\n\nimport { ModelDecorator } from \"../../Model/ModelDecorator\";\nimport { ModelPrototype } from \"../../Model/ModelPrototype\";\n\nimport { isObject } from \"../../Utils\";\n\nimport { BaseDocumentsRepository } from \"../BaseDocumentsRepository\";\n\n\nexport interface EventEmitterDocumentsRepositoryTrait extends GeneralRepository<Document> {\n\t$context:DocumentsContext;\n\n\ton( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\ton( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\toff( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\toff( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\tone( event:Event.CHILD_CREATED, uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_MODIFIED, uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.DOCUMENT_DELETED, uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_ADDED, uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event.MEMBER_REMOVED, uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n\tone( event:Event | string, uriPattern:string, onEvent:( message:EventMessage ) => void, onError?:( error:Error ) => void ):void;\n\n\n\tonChildCreated( uriPattern:string, onEvent:( message:ChildCreated ) => void, onError?:( error:Error ) => void ):void;\n\tonDocumentModified( uriPattern:string, onEvent:( message:DocumentModified ) => void, onError?:( error:Error ) => void ):void;\n\tonDocumentDeleted( uriPattern:string, onEvent:( message:DocumentDeleted ) => void, onError?:( error:Error ) => void ):void;\n\tonMemberAdded( uriPattern:string, onEvent:( message:MemberAdded ) => void, onError?:( error:Error ) => void ):void;\n\tonMemberRemoved( uriPattern:string, onEvent:( message:MemberRemoved ) => void, onError?:( error:Error ) => void ):void;\n}\n\n\ntype OnEvent<T extends EventMessage> = ( message:T ) => void;\ntype OnError = ( error:Error ) => void;\n\nexport type EventEmitterDocumentsRepositoryTraitFactory =\n\t& ModelPrototype<EventEmitterDocumentsRepositoryTrait, GeneralRepository<Document>>\n\t& ModelDecorator<EventEmitterDocumentsRepositoryTrait, BaseDocumentsRepository>\n\t;\n\nexport const EventEmitterDocumentsRepositoryTrait:EventEmitterDocumentsRepositoryTraitFactory = {\n\tPROTOTYPE: {\n\t\ton<T extends EventMessage>( this:EventEmitterDocumentsRepositoryTrait, event:Event | string, uriPattern:string, onEvent:OnEvent<T>, onError?:OnError ):void {\n\t\t\ttry {\n\t\t\t\tconst destination:string = _createDestination( event, uriPattern, this.$context.baseURI );\n\t\t\t\tthis.$context.messaging.subscribe( destination, onEvent, onError );\n\n\t\t\t} catch( error ) {\n\t\t\t\tif( ! onError ) throw error;\n\t\t\t\tonError( error );\n\t\t\t}\n\t\t},\n\n\t\toff<T extends EventMessage>( this:EventEmitterDocumentsRepositoryTrait, event:Event | string, uriPattern:string, onEvent:OnEvent<T>, onError?:OnError ):void {\n\t\t\ttry {\n\t\t\t\tconst destination:string = _createDestination( event, uriPattern, this.$context.baseURI );\n\t\t\t\tthis.$context.messaging.unsubscribe( destination, onEvent );\n\n\t\t\t} catch( error ) {\n\t\t\t\tif( ! onError ) throw error;\n\t\t\t\tonError( error );\n\t\t\t}\n\t\t},\n\n\t\tone<T extends EventMessage>( this:EventEmitterDocumentsRepositoryTrait, event:Event | string, uriPattern:string, onEvent:OnEvent<T>, onError?:OnError ):void {\n\t\t\ttry {\n\t\t\t\tconst destination:string = _createDestination( event, uriPattern, this.$context.baseURI );\n\n\t\t\t\tconst onEventWrapper:OnEvent<T> = message => {\n\t\t\t\t\tonEvent( message );\n\t\t\t\t\tthis.$context.messaging.unsubscribe( destination, onEventWrapper );\n\t\t\t\t};\n\n\t\t\t\tthis.$context.messaging.subscribe( destination, onEventWrapper, onError );\n\n\t\t\t} catch( error ) {\n\t\t\t\tif( ! onError ) throw error;\n\t\t\t\tonError( error );\n\t\t\t}\n\t\t},\n\n\n\t\tonChildCreated( this:EventEmitterDocumentsRepositoryTrait, uriPattern:string, onEvent:OnEvent<ChildCreated>, onError?:OnError ):void {\n\t\t\treturn this.on( Event.CHILD_CREATED, uriPattern, onEvent, onError );\n\t\t},\n\n\t\tonDocumentModified( this:EventEmitterDocumentsRepositoryTrait, uriPattern:string, onEvent:OnEvent<DocumentModified>, onError?:OnError ):void {\n\t\t\treturn this.on( Event.DOCUMENT_MODIFIED, uriPattern, onEvent, onError );\n\t\t},\n\n\t\tonDocumentDeleted( this:EventEmitterDocumentsRepositoryTrait, uriPattern:string, onEvent:OnEvent<DocumentDeleted>, onError?:OnError ):void {\n\t\t\treturn this.on( Event.DOCUMENT_DELETED, uriPattern, onEvent, onError );\n\t\t},\n\n\t\tonMemberAdded( this:EventEmitterDocumentsRepositoryTrait, uriPattern:string, onEvent:OnEvent<MemberAdded>, onError?:OnError ):void {\n\t\t\treturn this.on( Event.MEMBER_ADDED, uriPattern, onEvent, onError );\n\t\t},\n\n\t\tonMemberRemoved( this:EventEmitterDocumentsRepositoryTrait, uriPattern:string, onEvent:OnEvent<MemberRemoved>, onError?:OnError ):void {\n\t\t\treturn this.on( Event.MEMBER_REMOVED, uriPattern, onEvent, onError );\n\t\t},\n\t},\n\n\n\tisDecorated( object:object ):object is EventEmitterDocumentsRepositoryTrait {\n\t\treturn isObject( object )\n\t\t\t&& ModelDecorator\n\t\t\t\t.hasPropertiesFrom( EventEmitterDocumentsRepositoryTrait.PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends BaseDocumentsRepository>( object:T ):T & EventEmitterDocumentsRepositoryTrait {\n\t\tif( EventEmitterDocumentsRepositoryTrait.isDecorated( object ) ) return object;\n\n\t\tconst resource:T & GeneralRepository<Document> = ModelDecorator\n\t\t\t.decorateMultiple( object, GeneralRepository );\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( EventEmitterDocumentsRepositoryTrait.PROTOTYPE, resource );\n\t},\n};\n"]}