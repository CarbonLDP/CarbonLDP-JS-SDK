{"version":3,"sources":["Auth/Users.ts"],"names":[],"mappings":"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","file":"Users.js","sourcesContent":["import * as Context from \"./../Context\";\nimport * as Errors from \"./../Errors\";\nimport * as HTTP from \"./../HTTP\";\nimport * as Pointer from \"./../Pointer\";\nimport * as URI from \"./../RDF/URI\";\nimport * as Credentials from \"./Credentials\";\nimport * as PersistedCredentials from \"./PersistedCredentials\";\nimport * as PersistedUser from \"./PersistedUser\";\n\nexport class Class {\n\tprivate context:Context.Class;\n\n\tconstructor( context:Context.Class ) {\n\t\tthis.context = context;\n\t}\n\n\tregister( email:string, password:string, enabled?:boolean ):Promise<[ PersistedUser.Class, HTTP.Response.Class[] ]> {\n\t\tconst credentials:Credentials.Class = Credentials.Factory.create( email, password );\n\t\tcredentials.enabled = enabled;\n\t\treturn Promise.resolve()\n\t\t\t.then( () => {\n\t\t\t\tconst containerURI:string = this.getCredentialsContainerURI();\n\t\t\t\treturn this.context.documents.createChildAndRetrieve<PersistedCredentials.Class>( containerURI, credentials as any );\n\t\t\t} )\n\t\t\t.then<[ PersistedUser.Class, HTTP.Response.Class[] ]>( ( [ persistedCredentials, responses ] ) => [ persistedCredentials.user, responses ] );\n\t}\n\n\tget( userURI:string, requestOptions?:HTTP.Request.Options ):Promise<[ PersistedUser.Class, HTTP.Response.Class ]> {\n\t\treturn new Promise( resolve =>\n\t\t\tresolve( this.context.documents.get( this.resolveURI( userURI ), requestOptions ) )\n\t\t);\n\t}\n\n\tenableCredentials( userURI:string, requestOptions?:HTTP.Request.Options ):Promise<[ PersistedUser.Class, HTTP.Response.Class[] ]> {\n\t\treturn this.changeEnabledStatus( userURI, true, requestOptions );\n\t}\n\n\tdisableCredentials( userURI:string, requestOptions?:HTTP.Request.Options ):Promise<[ PersistedUser.Class, HTTP.Response.Class[] ]> {\n\t\treturn this.changeEnabledStatus( userURI, false, requestOptions );\n\t}\n\n\tdelete( userURI:string, requestOptions?:HTTP.Request.Options ):Promise<HTTP.Response.Class> {\n\t\treturn new Promise( resolve =>\n\t\t\tresolve( this.context.documents.delete( this.resolveURI( userURI ), requestOptions ) )\n\t\t);\n\t}\n\n\tprivate changeEnabledStatus( userURI:string, value:boolean, requestOptions?:HTTP.Request.Options ):Promise<[ PersistedUser.Class, HTTP.Response.Class[] ]> {\n\t\treturn Promise.resolve().then( () => {\n\t\t\tconst absoluteUserURI:string = this.resolveURI( userURI );\n\t\t\tconst userPointer:Pointer.Class = this.context.documents.getPointer( absoluteUserURI );\n\t\t\tconst persistedUser:PersistedUser.Class = PersistedUser.Factory.decorate( userPointer, this.context.documents );\n\n\t\t\tif( value ) return persistedUser.enableCredentials( requestOptions );\n\t\t\treturn persistedUser.disableCredentials( requestOptions );\n\t\t} );\n\t}\n\n\tprivate resolveURI( relativeURI:string ):string {\n\t\tconst usersContainer:string = this.getContainerURI();\n\t\tconst absoluteRoleURI:string = URI.Util.resolve( usersContainer, relativeURI );\n\t\tif( ! absoluteRoleURI.startsWith( usersContainer ) ) throw new Errors.IllegalArgumentError( `The provided URI \"${ relativeURI }\" isn't a valid Carbon LDP user.` );\n\n\t\treturn absoluteRoleURI;\n\t}\n\n\tprivate getContainerURI():string {\n\t\tif( ! this.context.hasSetting( \"system.users.container\" ) ) throw new Errors.IllegalStateError( `The \"system.users.container\" setting hasn't been defined.` );\n\t\treturn this.context.resolve( this.context.getSetting( \"system.users.container\" ) );\n\t}\n\n\tprivate getCredentialsContainerURI():string {\n\t\tif( ! this.context.hasSetting( \"system.credentials.container\" ) ) throw new Errors.IllegalStateError( `The \"system.credentials.container\" setting hasn't been defined.` );\n\t\treturn this.context.resolveSystemURI( this.context.getSetting( \"system.credentials.container\" ) );\n\t}\n}\n\nexport default Class;\n"]}