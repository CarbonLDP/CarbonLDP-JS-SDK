{"version":3,"sources":["Auth/PersistedUser.ts"],"names":[],"mappings":"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","file":"PersistedUser.js","sourcesContent":["import { Documents } from \"../Documents\";\nimport { RequestOptions } from \"../HTTP/Request\";\nimport { Response } from \"../HTTP/Response\";\nimport { Pointer } from \"../Pointer\";\nimport { CS } from \"../Vocabularies/CS\";\nimport { PersistedProtectedDocument } from \"./../PersistedProtectedDocument\";\nimport * as SELECTResults from \"../SPARQL/SelectResults\";\nimport * as Utils from \"./../Utils\";\nimport * as PersistedCredentials from \"./PersistedCredentials\";\n\nexport interface Class extends PersistedProtectedDocument {\n\tname?:string;\n\tcredentials?:PersistedCredentials.Class;\n\n\tenableCredentials( requestOptions?:RequestOptions ):Promise<[ Class, Response[] ]>;\n\n\tdisableCredentials( requestOptions?:RequestOptions ):Promise<[ Class, Response[] ]>;\n}\n\nexport class Factory {\n\tstatic hasClassProperties( object:Object ):boolean {\n\t\treturn Utils.isObject( object )\n\t\t\t&& Utils.hasFunction( object, \"enableCredentials\" )\n\t\t\t&& Utils.hasFunction( object, \"disableCredentials\" )\n\t\t\t;\n\t}\n\n\tstatic is( object:Object ):boolean {\n\t\treturn Factory.hasClassProperties( object )\n\t\t\t&& PersistedProtectedDocument.is( object )\n\t\t\t;\n\t}\n\n\tstatic decorate<T extends object>( object:T, documents:Documents ):Class & T {\n\t\tconst persistedUser:T & Class = <any> object;\n\n\t\tif( Factory.hasClassProperties( persistedUser ) ) return persistedUser;\n\t\tif( ! PersistedProtectedDocument.isDecorated( persistedUser ) ) PersistedProtectedDocument.decorate( persistedUser, documents );\n\n\t\tObject.defineProperties( persistedUser, {\n\t\t\t\"enableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, true ),\n\t\t\t},\n\t\t\t\"disableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, false ),\n\t\t\t},\n\t\t} );\n\t\tif( persistedUser.credentials ) PersistedCredentials.Factory.decorate( persistedUser.credentials, documents );\n\n\t\treturn persistedUser;\n\t}\n\n}\n\nfunction changeEnabledCredentials( this:Class, enabled:boolean, requestOptions?:RequestOptions ):Promise<[ Class, Response[] ]> {\n\tconst promise:Promise<void | Response> = \"credentials\" in this ?\n\t\tPromise.resolve() : obtainCredentials( this );\n\n\tlet responses:Response[] = [];\n\treturn promise.then( ( response ) => {\n\t\tif( response ) responses.push( response );\n\n\t\tif( enabled ) return this.credentials.enable( requestOptions );\n\t\treturn this.credentials.disable( requestOptions );\n\t} ).then<[ Class, Response[] ]>( ( [ _credentials, credentialsResponses ]:[ PersistedCredentials.Class, Response[] ] ) => {\n\t\tresponses.push( ...credentialsResponses );\n\n\t\treturn [ this, responses ];\n\t} );\n}\n\nfunction obtainCredentials( user:Class ):Promise<Response> {\n\treturn user\n\t\t.executeSELECTQuery( `BASE<${ user.id }>SELECT?c FROM<>WHERE{GRAPH<>{<><${ CS.credentials }>?c}}` )\n\t\t.then( ( [ { bindings: [ credentialsBinding ] }, response ]:[ SELECTResults.SPARQLSelectResults<{ credentials:Pointer }>, Response ] ) => {\n\t\t\tuser.credentials = PersistedCredentials.Factory.decorate( credentialsBinding.credentials, user._documents );\n\t\t\treturn response;\n\t\t} );\n}\n\nexport default Class;\n"]}