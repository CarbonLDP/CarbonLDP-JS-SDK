{"version":3,"sources":["Auth/PersistedUser.ts"],"names":[],"mappings":";;;;;;;;;AAEA,4EAA2E;AAE3E,yCAAwC;AACxC,gDAAoC;AACpC,2EAA+D;AAW/D;IAAA;IAuCA,CAAC;IAtCO,0BAAkB,GAAzB,UAA2B,MAAa;QACvC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAE,MAAM,CAAE;eAC3B,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,mBAAmB,CAAE;eAChD,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,oBAAoB,CAAE,CACnD;IACH,CAAC;IAEM,UAAE,GAAT,UAAW,MAAa;QACvB,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAE,MAAM,CAAE;eACvC,uDAA0B,CAAC,EAAE,CAAE,MAAM,CAAE,CACzC;IACH,CAAC;IAEM,gBAAQ,GAAf,UAAmC,MAAQ,EAAE,SAAmB;QAC/D,IAAM,aAAa,GAAmB,MAAM,CAAC;QAE7C,EAAE,CAAA,CAAE,OAAO,CAAC,kBAAkB,CAAE,aAAa,CAAG,CAAC;YAAC,MAAM,CAAC,aAAa,CAAC;QACvE,EAAE,CAAA,CAAE,CAAE,uDAA0B,CAAC,WAAW,CAAE,aAAa,CAAG,CAAC;YAAC,uDAA0B,CAAC,QAAQ,CAAE,aAAa,EAAE,SAAS,CAAE,CAAC;QAEhI,MAAM,CAAC,gBAAgB,CAAE,aAAa,EAAE;YACvC,mBAAmB,EAAE;gBACpB,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,wBAAwB,CAAC,IAAI,CAAE,aAAa,EAAE,IAAI,CAAE;aAC3D;YACD,oBAAoB,EAAE;gBACrB,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,wBAAwB,CAAC,IAAI,CAAE,aAAa,EAAE,KAAK,CAAE;aAC5D;SACD,CAAE,CAAC;QACJ,EAAE,CAAA,CAAE,aAAa,CAAC,WAAY,CAAC;YAAC,oBAAoB,CAAC,OAAO,CAAC,QAAQ,CAAE,aAAa,CAAC,WAAW,EAAE,SAAS,CAAE,CAAC;QAE9G,MAAM,CAAC,aAAa,CAAC;IACtB,CAAC;IAEF,cAAC;AAAD,CAvCA,AAuCC,IAAA;AAvCY,0BAAO;AAyCpB,kCAA+C,OAAe,EAAE,cAA8B;IAA9F,iBAQC;IAPA,MAAM,CAAC,iBAAiB,CAAE,IAAI,CAAE;SAC9B,IAAI,CAAE;QACN,EAAE,CAAA,CAAE,OAAQ,CAAC;YAAC,MAAM,CAAC,KAAI,CAAC,WAAW,CAAC,MAAM,CAAE,cAAc,CAAE,CAAC;QAC/D,MAAM,CAAC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAE,cAAc,CAAE,CAAC;IACnD,CAAC,CAAE,CAAC,IAAI,CAAE;QACT,MAAM,CAAC,KAAI,CAAC;IACb,CAAC,CAAE,CAAC;AACN,CAAC;AAED,2BAA4B,IAAU;IACrC,EAAE,CAAA,CAAE,oBAAoB,CAAC,OAAO,CAAC,kBAAkB,CAAE,IAAI,CAAC,WAAW,CAAG,CAAC;QACxE,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAE1B,MAAM,CAAC,IAAI;SACT,kBAAkB,CAA2B,UAAS,IAAI,CAAC,EAAE,yCAAsC,OAAE,CAAC,WAAW,UAAQ,CAAE;SAC3H,IAAI,CAAE,UAAE,EAAoC;YAAtB,mCAAkB;QACxC,IAAI,CAAC,WAAW,GAAG,oBAAoB,CAAC,OAAO,CAAC,QAAQ,CAAE,kBAAkB,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,CAAE,CAAC;IAC7G,CAAC,CAAE,CAAC;AACN,CAAC","file":"PersistedUser.js","sourcesContent":["import { Documents } from \"../Documents\";\nimport { RequestOptions } from \"../HTTP/Request\";\nimport { PersistedProtectedDocument } from \"../PersistedProtectedDocument\";\nimport { Pointer } from \"../Pointer\";\nimport { CS } from \"../Vocabularies/CS\";\nimport * as Utils from \"./../Utils\";\nimport * as PersistedCredentials from \"./PersistedCredentials\";\n\nexport interface Class extends PersistedProtectedDocument {\n\tname?:string;\n\tcredentials?:PersistedCredentials.Class;\n\n\tenableCredentials( requestOptions?:RequestOptions ):Promise<Class>;\n\n\tdisableCredentials( requestOptions?:RequestOptions ):Promise<Class>;\n}\n\nexport class Factory {\n\tstatic hasClassProperties( object:Object ):boolean {\n\t\treturn Utils.isObject( object )\n\t\t\t&& Utils.hasFunction( object, \"enableCredentials\" )\n\t\t\t&& Utils.hasFunction( object, \"disableCredentials\" )\n\t\t\t;\n\t}\n\n\tstatic is( object:Object ):boolean {\n\t\treturn Factory.hasClassProperties( object )\n\t\t\t&& PersistedProtectedDocument.is( object )\n\t\t\t;\n\t}\n\n\tstatic decorate<T extends object>( object:T, documents:Documents ):Class & T {\n\t\tconst persistedUser:T & Class = <any> object;\n\n\t\tif( Factory.hasClassProperties( persistedUser ) ) return persistedUser;\n\t\tif( ! PersistedProtectedDocument.isDecorated( persistedUser ) ) PersistedProtectedDocument.decorate( persistedUser, documents );\n\n\t\tObject.defineProperties( persistedUser, {\n\t\t\t\"enableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, true ),\n\t\t\t},\n\t\t\t\"disableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, false ),\n\t\t\t},\n\t\t} );\n\t\tif( persistedUser.credentials ) PersistedCredentials.Factory.decorate( persistedUser.credentials, documents );\n\n\t\treturn persistedUser;\n\t}\n\n}\n\nfunction changeEnabledCredentials( this:Class, enabled:boolean, requestOptions?:RequestOptions ):Promise<Class> {\n\treturn ensureCredentials( this )\n\t\t.then( () => {\n\t\t\tif( enabled ) return this.credentials.enable( requestOptions );\n\t\t\treturn this.credentials.disable( requestOptions );\n\t\t} ).then( () => {\n\t\t\treturn this;\n\t\t} );\n}\n\nfunction ensureCredentials( user:Class ):Promise<void> {\n\tif( PersistedCredentials.Factory.hasClassProperties( user.credentials ) )\n\t\treturn Promise.resolve();\n\n\treturn user\n\t\t.executeSELECTQuery<{ credentials:Pointer }>( `BASE<${ user.id }>SELECT?c FROM<>WHERE{GRAPH<>{<><${ CS.credentials }>?c}}` )\n\t\t.then( ( { bindings: [ credentialsBinding ] } ) => {\n\t\t\tuser.credentials = PersistedCredentials.Factory.decorate( credentialsBinding.credentials, user._documents );\n\t\t} );\n}\n\nexport default Class;\n"]}