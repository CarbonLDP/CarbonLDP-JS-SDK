{"version":3,"sources":["Auth/PersistedUser.ts"],"names":[],"mappings":";;;;;;;;;AAAA,yCAAwC;AAGxC,0FAA8E;AAG9E,gDAAoC;AACpC,2EAA+D;AAW/D;IAAA;IAuCA,CAAC;IAtCO,0BAAkB,GAAzB,UAA2B,MAAa;QACvC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAE,MAAM,CAAE;eAC3B,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,mBAAmB,CAAE;eAChD,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,oBAAoB,CAAE,CACnD;IACH,CAAC;IAEM,UAAE,GAAT,UAAW,MAAa;QACvB,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAE,MAAM,CAAE;eACvC,0BAA0B,CAAC,OAAO,CAAC,EAAE,CAAE,MAAM,CAAE,CACjD;IACH,CAAC;IAEM,gBAAQ,GAAf,UAAmC,MAAQ,EAAE,SAAyB;QACrE,IAAM,aAAa,GAAmB,MAAM,CAAC;QAE7C,EAAE,CAAA,CAAE,OAAO,CAAC,kBAAkB,CAAE,aAAa,CAAG,CAAC;YAAC,MAAM,CAAC,aAAa,CAAC;QACvE,EAAE,CAAA,CAAE,CAAE,0BAA0B,CAAC,OAAO,CAAC,kBAAkB,CAAE,aAAa,CAAG,CAAC;YAAC,0BAA0B,CAAC,OAAO,CAAC,QAAQ,CAAE,aAAa,EAAE,SAAS,CAAE,CAAC;QAEvJ,MAAM,CAAC,gBAAgB,CAAE,aAAa,EAAE;YACvC,mBAAmB,EAAE;gBACpB,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,wBAAwB,CAAC,IAAI,CAAE,aAAa,EAAE,IAAI,CAAE;aAC3D;YACD,oBAAoB,EAAE;gBACrB,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,wBAAwB,CAAC,IAAI,CAAE,aAAa,EAAE,KAAK,CAAE;aAC5D;SACD,CAAE,CAAC;QACJ,EAAE,CAAA,CAAE,aAAa,CAAC,WAAY,CAAC;YAAC,oBAAoB,CAAC,OAAO,CAAC,QAAQ,CAAE,aAAa,CAAC,WAAW,EAAE,SAAS,CAAE,CAAC;QAE9G,MAAM,CAAC,aAAa,CAAC;IACtB,CAAC;IAEF,cAAC;AAAD,CAvCA,AAuCC,IAAA;AAvCY,0BAAO;AAyCpB,kCAA+C,OAAe,EAAE,cAAoC;IAApG,iBAeC;IAdA,IAAM,OAAO,GAAuC,aAAa,IAAI,IAAI,CAAC,CAAC;QAC1E,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,iBAAiB,CAAE,IAAI,CAAE,CAAC;IAE/C,IAAI,SAAS,GAAyB,EAAE,CAAC;IACzC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAE,UAAE,QAAQ;QAC9B,EAAE,CAAA,CAAE,QAAS,CAAC;YAAC,SAAS,CAAC,IAAI,CAAE,QAAQ,CAAE,CAAC;QAE1C,EAAE,CAAA,CAAE,OAAQ,CAAC;YAAC,MAAM,CAAC,KAAI,CAAC,WAAW,CAAC,MAAM,CAAE,cAAc,CAAE,CAAC;QAC/D,MAAM,CAAC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAE,cAAc,CAAE,CAAC;IACnD,CAAC,CAAE,CAAC,IAAI,CAAoC,UAAE,EAA4F;YAA1F,oBAAY,EAAE,4BAAoB;QACjF,SAAS,CAAC,IAAI,OAAd,SAAS,EAAU,oBAAoB,EAAG;QAE1C,MAAM,CAAC,CAAE,KAAI,EAAE,SAAS,CAAE,CAAC;IAC5B,CAAC,CAAE,CAAC;AACL,CAAC;AAED,2BAA4B,IAAU;IACrC,MAAM,CAAC,IAAI;SACT,kBAAkB,CAAE,UAAS,IAAI,CAAC,EAAE,yCAAsC,OAAE,CAAC,WAAW,UAAQ,CAAE;SAClG,IAAI,CAAE,UAAE,EAAwH;YAAxG,sCAAkB,EAAM,gBAAQ;QACxD,IAAI,CAAC,WAAW,GAAG,oBAAoB,CAAC,OAAO,CAAC,QAAQ,CAAE,kBAAkB,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,CAAE,CAAC;QAC5G,MAAM,CAAC,QAAQ,CAAC;IACjB,CAAC,CAAE,CAAC;AACN,CAAC","file":"PersistedUser.js","sourcesContent":["import { CS } from \"../Vocabularies/CS\";\nimport * as Documents from \"./../Documents\";\nimport * as HTTP from \"./../HTTP\";\nimport * as PersistedProtectedDocument from \"./../PersistedProtectedDocument\";\nimport { Pointer } from \"./../Pointer\";\nimport * as SELECTResults from \"./../SPARQL/SELECTResults\";\nimport * as Utils from \"./../Utils\";\nimport * as PersistedCredentials from \"./PersistedCredentials\";\n\nexport interface Class extends PersistedProtectedDocument.Class {\n\tname?:string;\n\tcredentials?:PersistedCredentials.Class;\n\n\tenableCredentials( requestOptions?:HTTP.Request.Options ):Promise<[ Class, HTTP.Response.Class[] ]>;\n\n\tdisableCredentials( requestOptions?:HTTP.Request.Options ):Promise<[ Class, HTTP.Response.Class[] ]>;\n}\n\nexport class Factory {\n\tstatic hasClassProperties( object:Object ):boolean {\n\t\treturn Utils.isObject( object )\n\t\t\t&& Utils.hasFunction( object, \"enableCredentials\" )\n\t\t\t&& Utils.hasFunction( object, \"disableCredentials\" )\n\t\t\t;\n\t}\n\n\tstatic is( object:Object ):boolean {\n\t\treturn Factory.hasClassProperties( object )\n\t\t\t&& PersistedProtectedDocument.Factory.is( object )\n\t\t\t;\n\t}\n\n\tstatic decorate<T extends object>( object:T, documents:Documents.Class ):Class & T {\n\t\tconst persistedUser:T & Class = <any> object;\n\n\t\tif( Factory.hasClassProperties( persistedUser ) ) return persistedUser;\n\t\tif( ! PersistedProtectedDocument.Factory.hasClassProperties( persistedUser ) ) PersistedProtectedDocument.Factory.decorate( persistedUser, documents );\n\n\t\tObject.defineProperties( persistedUser, {\n\t\t\t\"enableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, true ),\n\t\t\t},\n\t\t\t\"disableCredentials\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: changeEnabledCredentials.bind( persistedUser, false ),\n\t\t\t},\n\t\t} );\n\t\tif( persistedUser.credentials ) PersistedCredentials.Factory.decorate( persistedUser.credentials, documents );\n\n\t\treturn persistedUser;\n\t}\n\n}\n\nfunction changeEnabledCredentials( this:Class, enabled:boolean, requestOptions?:HTTP.Request.Options ):Promise<[ Class, HTTP.Response.Class[] ]> {\n\tconst promise:Promise<void | HTTP.Response.Class> = \"credentials\" in this ?\n\t\tPromise.resolve() : obtainCredentials( this );\n\n\tlet responses:HTTP.Response.Class[] = [];\n\treturn promise.then( ( response ) => {\n\t\tif( response ) responses.push( response );\n\n\t\tif( enabled ) return this.credentials.enable( requestOptions );\n\t\treturn this.credentials.disable( requestOptions );\n\t} ).then<[ Class, HTTP.Response.Class[] ]>( ( [ _credentials, credentialsResponses ]:[ PersistedCredentials.Class, HTTP.Response.Class[] ] ) => {\n\t\tresponses.push( ...credentialsResponses );\n\n\t\treturn [ this, responses ];\n\t} );\n}\n\nfunction obtainCredentials( user:Class ):Promise<HTTP.Response.Class> {\n\treturn user\n\t\t.executeSELECTQuery( `BASE<${ user.id }>SELECT?c FROM<>WHERE{GRAPH<>{<><${ CS.credentials }>?c}}` )\n\t\t.then( ( [ { bindings: [ credentialsBinding ] }, response ]:[ SELECTResults.Class<{ credentials:Pointer }>, HTTP.Response.Class ] ) => {\n\t\t\tuser.credentials = PersistedCredentials.Factory.decorate( credentialsBinding.credentials, user._documents );\n\t\t\treturn response;\n\t\t} );\n}\n\nexport default Class;\n"]}