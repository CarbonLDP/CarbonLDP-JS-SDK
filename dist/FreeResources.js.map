{"version":3,"sources":["FreeResources.ts"],"names":[],"mappings":"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","file":"FreeResources.js","sourcesContent":["import * as Documents from \"./Documents\";\nimport {\n\tIDAlreadyInUseError,\n\tIllegalArgumentError,\n} from \"./Errors\";\nimport * as JSONLDConverter from \"./JSONLD/Converter\";\nimport { ModelDecorator } from \"./ModelDecorator\";\nimport { ModelFactory } from \"./ModelFactory\";\nimport * as ObjectSchema from \"./ObjectSchema\";\nimport {\n\tPointer,\n\tPointerLibrary,\n\tPointerValidator,\n} from \"./Pointer\";\nimport * as URI from \"./RDF/URI\";\nimport * as RDFNode from \"./RDF/Node\";\nimport { Resource } from \"./Resource\";\nimport * as Utils from \"./Utils\";\n\nexport interface FreeResources extends PointerLibrary, PointerValidator {\n\t_documents:Documents.Class;\n\t_resourcesIndex:Map<string, Resource>;\n\n\thasResource( id:string ):boolean;\n\n\tgetResource( id:string ):Resource;\n\n\tgetResources():Resource[];\n\n\tgetPointer( id:string ):Resource;\n\n\tcreateResource( id?:string ):Resource;\n\n\tcreateResourceFrom<T>( object:T, id?:string ):Resource & T;\n\n\ttoJSON():object;\n}\n\n\nexport interface FreeResourcesFactory extends ModelFactory<FreeResources>, ModelDecorator<FreeResources> {\n\tis( object:object ):object is FreeResources;\n\n\tisDecorated( object:object ):object is FreeResources;\n\n\n\tcreate( documents:Documents.Class ):FreeResources;\n\n\tcreateFrom<T extends object>( object:T, documents:Documents.Class ):T & FreeResources;\n\n\tdecorate<T extends object>( object:T, documents:Documents.Class ):T & FreeResources;\n}\n\n\nfunction hasPointer( this:FreeResources, id:string ):boolean {\n\tif( ! inLocalScope( id ) ) {\n\t\treturn this._documents.hasPointer( id );\n\t}\n\n\treturn this.hasResource( id );\n}\n\nfunction getPointer( this:FreeResources, id:string ):Pointer {\n\tif( ! inLocalScope( id ) ) {\n\t\treturn this._documents.getPointer( id );\n\t}\n\n\tlet resource:Resource = this.getResource( id );\n\n\treturn ! resource ? this.createResource( id ) : resource;\n}\n\nfunction inLocalScope( id:string ):boolean {\n\treturn URI.Util.isBNodeID( id );\n}\n\nfunction inScope( this:FreeResources, idOrPointer:string | Pointer ):boolean {\n\tlet id:string = Utils.isString( idOrPointer ) ? idOrPointer : idOrPointer.id;\n\n\treturn inLocalScope( id ) || this._documents.inScope( id );\n}\n\nfunction hasResource( this:FreeResources, id:string ):boolean {\n\treturn this._resourcesIndex.has( id );\n}\n\nfunction getResource( this:FreeResources, id:string ):Resource {\n\treturn this._resourcesIndex.get( id ) || null;\n}\n\nfunction getResources( this:FreeResources ):Resource[] {\n\treturn Utils.A.from( this._resourcesIndex.values() );\n}\n\nfunction createResource( this:FreeResources, id?:string ):Resource {\n\treturn this.createResourceFrom( {}, id );\n}\n\nfunction createResourceFrom<T extends object>( this:FreeResources, object:T, id?:string ):Resource & T {\n\tif( id ) {\n\t\tif( ! inLocalScope( id ) ) throw new IllegalArgumentError( `The id \"${ id }\" is out of scope.` );\n\t\tif( this._resourcesIndex.has( id ) ) throw new IDAlreadyInUseError( `The id \"${ id }\" is already in use by another resource.` );\n\t} else {\n\t\tid = URI.Util.generateBNodeID();\n\t}\n\n\tlet resource:Resource & T = Resource.createFrom<T>( object, id );\n\tthis._resourcesIndex.set( id, resource );\n\n\treturn resource;\n}\n\nfunction toJSON( this:FreeResources, key?:string ):RDFNode.Class[] {\n\tconst generalSchema:ObjectSchema.DigestedObjectSchema = this._documents.getGeneralSchema();\n\tconst jsonldConverter:JSONLDConverter.Class = this._documents.jsonldConverter;\n\n\treturn this\n\t\t.getResources()\n\t\t.map( resource => {\n\t\t\tconst resourceSchema:ObjectSchema.DigestedObjectSchema = this._documents.getSchemaFor( resource );\n\t\t\treturn jsonldConverter.expand( resource, generalSchema, resourceSchema );\n\t\t} )\n\t\t;\n}\n\nexport const FreeResources:FreeResourcesFactory = {\n\tis( object:object ):object is FreeResources {\n\t\treturn FreeResources.isDecorated( object )\n\t\t\t;\n\t},\n\n\tisDecorated( object:object ):object is FreeResources {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_documents\" ) &&\n\t\t\tUtils.hasPropertyDefined( object, \"_resourcesIndex\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResources\" ) &&\n\t\t\tUtils.hasFunction( object, \"createResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"createResourceFrom\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasPointer\" ) &&\n\t\t\tUtils.hasFunction( object, \"getPointer\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"inScope\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"toJSON\" )\n\t\t);\n\t},\n\n\n\tcreate( documents:Documents.Class ):FreeResources {\n\t\treturn FreeResources.createFrom( {}, documents );\n\t},\n\n\tcreateFrom<T extends object>( object:T, documents:Documents.Class ):T & FreeResources {\n\t\treturn FreeResources.decorate<T>( object, documents );\n\t},\n\n\tdecorate<T extends object>( object:T, documents:Documents.Class ):T & FreeResources {\n\t\tif( FreeResources.isDecorated( object ) ) return object;\n\n\t\tObject.defineProperties( object, {\n\t\t\t\"_documents\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: documents,\n\t\t\t},\n\t\t\t\"_resourcesIndex\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: new Map<string, Resource>(),\n\t\t\t},\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasPointer,\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getPointer,\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: inScope,\n\t\t\t},\n\t\t\t\"hasResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasResource,\n\t\t\t},\n\t\t\t\"getResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResource,\n\t\t\t},\n\t\t\t\"getResources\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResources,\n\t\t\t},\n\t\t\t\"createResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createResource,\n\t\t\t},\n\t\t\t\"createResourceFrom\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createResourceFrom,\n\t\t\t},\n\t\t\t\"toJSON\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: toJSON,\n\t\t\t},\n\t\t} );\n\n\t\treturn <any> object;\n\t},\n};\n\n\nexport default FreeResources;\n"]}