{"version":3,"sources":["FreeResources.ts"],"names":[],"mappings":"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","file":"FreeResources.js","sourcesContent":["import Documents from \"./Documents\";\nimport * as Errors from \"./Errors\";\nimport * as Pointer from \"./Pointer\";\nimport * as RDF from \"./RDF\";\nimport * as Resource from \"./Resource\";\nimport * as Utils from \"./Utils\";\n\nexport interface Class extends Pointer.Library, Pointer.Validator {\n\t_documents:Documents;\n\t_resourcesIndex:Map<string, Resource.Class>;\n\n\thasResource( id:string ):boolean;\n\tgetResource( id:string ):Resource.Class;\n\tgetResources():Resource.Class[];\n\n\tcreateResource( id?:string ):Resource.Class;\n\n\ttoJSON():string;\n}\n\nfunction hasPointer( id:string ):boolean {\n\tlet freeResources:Class = <Class> this;\n\n\tif( ! inLocalScope( id ) ) {\n\t\treturn freeResources._documents.hasPointer( id );\n\t}\n\n\treturn freeResources.hasResource( id );\n}\n\nfunction getPointer( id:string ):Pointer.Class {\n\tlet freeResources:Class = <Class> this;\n\n\tif( ! inLocalScope( id ) ) {\n\t\treturn freeResources._documents.getPointer( id );\n\t}\n\n\tlet resource:Resource.Class = freeResources.getResource( id );\n\n\treturn ! resource ? freeResources.createResource( id ) : resource;\n}\n\nfunction inLocalScope( id:string ):boolean {\n\treturn RDF.URI.Util.isBNodeID( id );\n}\n\nfunction inScope( pointer:Pointer.Class ):boolean;\nfunction inScope( id:string ):boolean;\nfunction inScope( idOrPointer:any ):boolean {\n\tlet freeResources:Class = <Class> this;\n\tlet id:string = Pointer.Factory.is( idOrPointer ) ? idOrPointer.id : idOrPointer;\n\n\treturn inLocalScope( id )\n\t\t|| freeResources._documents.inScope( id );\n}\n\nfunction hasResource( id:string ):boolean {\n\tlet freeResources:Class = <Class> this;\n\n\treturn freeResources._resourcesIndex.has( id );\n}\n\nfunction getResource( id:string ):Resource.Class {\n\tlet freeResources:Class = <Class> this;\n\n\treturn freeResources._resourcesIndex.get( id ) || null;\n}\n\nfunction getResources():Resource.Class[] {\n\tlet freeResources:Class = <Class> this;\n\n\treturn Utils.A.from( freeResources._resourcesIndex.values() );\n}\n\nfunction createResource( id?:string ):Resource.Class {\n\tlet freeResources:Class = <Class> this;\n\n\tif( id ) {\n\t\tif( ! inLocalScope( id ) ) throw new Errors.IllegalArgumentError( `The id \"${ id }\" is out of scope.` );\n\t\tif( freeResources._resourcesIndex.has( id ) ) throw new Errors.IDAlreadyInUseError( `The id \"${ id }\" is already in use by another resource.` );\n\t} else {\n\t\tid = RDF.URI.Util.generateBNodeID();\n\t}\n\n\tlet resource:Resource.Class = Resource.Factory.create( id );\n\tfreeResources._resourcesIndex.set( id, resource );\n\n\treturn resource;\n}\n\nfunction toJSON():string {\n\tlet resources:Resource.Class[] = this.getResources();\n\tlet expandedResources:RDF.Node.Class[] = [];\n\n\tfor( let resource of resources ) {\n\t\texpandedResources.push( this._documents.jsonldConverter.expand( resource, this._documents.getSchemaFor( resource ) ) );\n\t}\n\n\treturn JSON.stringify( expandedResources );\n}\n\nexport class Factory {\n\tstatic hasClassProperties( object:Object ):boolean {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_documents\" ) &&\n\t\t\tUtils.hasPropertyDefined( object, \"_resourcesIndex\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResources\" ) &&\n\t\t\tUtils.hasFunction( object, \"createResource\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasPointer\" ) &&\n\t\t\tUtils.hasFunction( object, \"getPointer\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"inScope\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"toJSON\" )\n\t\t);\n\t}\n\n\tstatic create( documents:Documents ):Class {\n\t\treturn Factory.createFrom( {}, documents );\n\t}\n\n\tstatic createFrom<T extends Object>( object:T, documents:Documents ):T & Class {\n\t\tlet freeResources:T & Class = Factory.decorate<T>( object );\n\t\tfreeResources._documents = documents;\n\n\t\treturn freeResources;\n\t}\n\n\tstatic decorate<T extends Object>( object:T ):T & Class {\n\t\tif( Factory.hasClassProperties( object ) ) return <any> object;\n\n\t\tObject.defineProperties( object, {\n\t\t\t\"_resourcesIndex\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: new Map<string, Resource.Class>(),\n\t\t\t},\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasPointer,\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getPointer,\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: inScope,\n\t\t\t},\n\t\t\t\"hasResource\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasResource,\n\t\t\t},\n\t\t\t\"getResource\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResource,\n\t\t\t},\n\t\t\t\"getResources\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResources,\n\t\t\t},\n\t\t\t\"createResource\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createResource,\n\t\t\t},\n\t\t\t\"toJSON\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: toJSON,\n\t\t\t},\n\t\t} );\n\n\t\treturn <any> object;\n\t}\n}\n\nexport default Class;\n"],"sourceRoot":"/source/"}