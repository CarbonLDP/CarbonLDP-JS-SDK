{"version":3,"sources":["Pointer.ts"],"names":[],"mappings":";;;;;;;;;AAAA,mCAA6C;AAK7C,6CAAiC;AAgDjC;IACC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;AACvB,CAAC;AAFD,8CAEC;AAED;IACC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAE,IAAI,0BAAiB,CAAE,iDAAiD,CAAE,CAAE,CAAC;AACrG,CAAC;AAFD,4DAEC;AAEY,QAAA,OAAO,GAAkB;IACrC,WAAW,EAAX,UAAa,MAAa;QACzB,MAAM,CAAC,CACN,KAAK,CAAC,kBAAkB,CAAE,MAAM,EAAE,KAAK,CAAE;YACzC,KAAK,CAAC,kBAAkB,CAAE,MAAM,EAAE,WAAW,CAAE;YAE/C,KAAK,CAAC,kBAAkB,CAAE,MAAM,EAAE,IAAI,CAAE;YACxC,KAAK,CAAC,WAAW,CAAE,MAAM,EAAE,YAAY,CAAE;YACzC,KAAK,CAAC,kBAAkB,CAAE,MAAM,EAAE,SAAS,CAAE,CAC7C,CAAC;IACH,CAAC;IAED,EAAE,EAAF,UAAI,MAAU;QACb,MAAM,CAAC,CACN,KAAK,CAAC,QAAQ,CAAE,MAAM,CAAE;YACxB,eAAO,CAAC,WAAW,CAAE,MAAM,CAAE,CAC7B,CAAC;IACH,CAAC;IAGD,MAAM,EAAN,UAAQ,EAAU;QACjB,MAAM,CAAC,eAAO,CAAC,UAAU,CAAE,EAAE,EAAE,EAAE,CAAE,CAAC;IACrC,CAAC;IAED,UAAU,EAAV,UAA8B,MAAQ,EAAE,EAAU;QACjD,IAAM,OAAO,GAAe,eAAO,CAAC,QAAQ,CAAK,MAAM,CAAE,CAAC;QAE1D,EAAE,CAAA,CAAE,EAAG,CAAC;YAAC,OAAO,CAAC,EAAE,GAAG,EAAE,CAAC;QAEzB,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;IAED,QAAQ,EAAR,UAA4B,MAAQ;QACnC,EAAE,CAAA,CAAE,eAAO,CAAC,WAAW,CAAE,MAAM,CAAG,CAAC;YAAC,MAAM,CAAC,MAAM,CAAC;QAElD,IAAM,OAAO,GAAe,MAAqB,CAAC;QAClD,MAAM,CAAC,gBAAgB,CAAE,OAAO,EAAE;YACjC,KAAK,EAAE;gBACN,QAAQ,EAAE,IAAI;gBACd,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,OAAO,CAAC,EAAE,IAAI,EAAE;aACvB;YACD,WAAW,EAAE;gBACZ,QAAQ,EAAE,IAAI;gBACd,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,OAAO,CAAC,SAAS,IAAI,KAAK;aACjC;YACD,IAAI,EAAE;gBACL,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,GAAG,EAAH;oBACC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;gBACjB,CAAC;gBACD,GAAG,EAAH,UAAmB,KAAY;oBAC9B,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC;gBAClB,CAAC;aACD;YACD,YAAY,EAAE;gBACb,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,iBAAiB;aACxB;YACD,SAAS,EAAE;gBACV,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,KAAK,EAAE,wBAAwB;aAC/B;SACD,CAAE,CAAC;QAEJ,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;IAGD,QAAQ,EAAR,UAAU,QAAgB,EAAE,QAAgB;QAC3C,MAAM,CAAC,QAAQ,CAAC,EAAE,KAAK,QAAQ,CAAC,EAAE,CAAC;IACpC,CAAC;IAED,MAAM,EAAN,UAAQ,QAAkB;QACzB,MAAM,CAAC,QAAQ;aACb,GAAG,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,EAAE,EAAV,CAAU,CAAE,CAC5B;IACH,CAAC;IAED,UAAU,EAAV,UAA8B,QAAkB;QAC/C,IAAM,QAAQ,GAAkD,QAAQ,CAAC,GAAG,CAAE,UAAE,OAAe,IAAM,OAAA,OAAO,CAAC,OAAO,EAAK,EAApB,CAAoB,CAAE,CAAC;QAC5H,MAAM,CAAC,OAAO;aACZ,GAAG,CAAuC,QAAQ,CAAE;aACpD,IAAI,CAA6C,UAAE,OAA6C;YAChG,IAAI,gBAAgB,GAA6B,OAAO,CAAC,GAAG,CAAE,UAAE,MAA0C,IAAM,OAAA,MAAM,CAAE,CAAC,CAAE,EAAX,CAAW,CAAE,CAAC;YAC9H,IAAI,SAAS,GAAc,OAAO,CAAC,GAAG,CAAE,UAAE,MAA0C,IAAM,OAAA,MAAM,CAAE,CAAC,CAAE,EAAX,CAAW,CAAE,CAAC;YAExG,MAAM,CAAC,CAAE,gBAAgB,EAAE,SAAS,CAAE,CAAC;QACxC,CAAC,CAAE,CAAC;IACN,CAAC;CACD,CAAC","file":"Pointer.js","sourcesContent":["import { IllegalStateError } from \"./Errors\";\nimport { Response } from \"./HTTP/Response\";\nimport { ModelDecorator } from \"./ModelDecorator\";\nimport { ModelFactory } from \"./ModelFactory\";\nimport { PersistedDocument } from \"./PersistedDocument\";\nimport * as Utils from \"./Utils\";\n\n\nexport interface Pointer {\n\t_id:string;\n\t_resolved:boolean;\n\n\tid:string;\n\n\tisResolved():boolean;\n\n\tresolve<T>():Promise<[ T & PersistedDocument, Response ]>;\n}\n\n\nexport interface PointerLibrary {\n\thasPointer( id:string ):boolean;\n\n\tgetPointer( id:string ):Pointer;\n}\n\n\nexport interface PointerValidator {\n\tinScope( idOrPointer:string | Pointer ):boolean;\n}\n\n\nexport interface PointerFactory extends ModelFactory<Pointer>, ModelDecorator<Pointer> {\n\tisDecorated( object:object ):object is Pointer;\n\n\tis( object:object ):object is Pointer;\n\n\n\tcreate( id?:string ):Pointer;\n\n\tcreateFrom<T extends object>( object:T, id?:string ):T & Pointer;\n\n\tdecorate<T extends object>( object:T ):T & Pointer;\n\n\n\tareEqual( pointer1:Pointer, pointer2:Pointer ):boolean;\n\n\tgetIDs( pointers:Pointer[] ):string[];\n\n\tresolveAll<T extends object>( pointers:Pointer[] ):Promise<[ (T & PersistedDocument)[], Response[] ]>;\n}\n\n\nexport function isPointerResolved( this:Pointer ):boolean {\n\treturn this._resolved;\n}\n\nexport function resolveStandalonePointer( this:Pointer ):Promise<[ Pointer, Response ]> {\n\treturn Promise.reject( new IllegalStateError( \"The pointer has not been assigned to a context.\" ) );\n}\n\nexport const Pointer:PointerFactory = {\n\tisDecorated( object:object ):object is Pointer {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_id\" ) &&\n\t\t\tUtils.hasPropertyDefined( object, \"_resolved\" ) &&\n\n\t\t\tUtils.hasPropertyDefined( object, \"id\" ) &&\n\t\t\tUtils.hasFunction( object, \"isResolved\" ) &&\n\t\t\tUtils.hasPropertyDefined( object, \"resolve\" )\n\t\t);\n\t},\n\n\tis( object:any ):object is Pointer {\n\t\treturn (\n\t\t\tUtils.isObject( object ) &&\n\t\t\tPointer.isDecorated( object )\n\t\t);\n\t},\n\n\n\tcreate( id?:string ):Pointer {\n\t\treturn Pointer.createFrom( {}, id );\n\t},\n\n\tcreateFrom<T extends object>( object:T, id?:string ):T & Pointer {\n\t\tconst pointer:T & Pointer = Pointer.decorate<T>( object );\n\n\t\tif( id ) pointer.id = id;\n\n\t\treturn pointer;\n\t},\n\n\tdecorate<T extends object>( object:T ):T & Pointer {\n\t\tif( Pointer.isDecorated( object ) ) return object;\n\n\t\tconst pointer:T & Pointer = object as T & Pointer;\n\t\tObject.defineProperties( pointer, {\n\t\t\t\"_id\": {\n\t\t\t\twritable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: pointer.id || \"\",\n\t\t\t},\n\t\t\t\"_resolved\": {\n\t\t\t\twritable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: pointer._resolved || false,\n\t\t\t},\n\t\t\t\"id\": {\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tget( this:Pointer ):string {\n\t\t\t\t\treturn this._id;\n\t\t\t\t},\n\t\t\t\tset( this:Pointer, value:string ):void {\n\t\t\t\t\tthis._id = value;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"isResolved\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: isPointerResolved,\n\t\t\t},\n\t\t\t\"resolve\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: resolveStandalonePointer,\n\t\t\t},\n\t\t} );\n\n\t\treturn pointer;\n\t},\n\n\n\tareEqual( pointer1:Pointer, pointer2:Pointer ):boolean {\n\t\treturn pointer1.id === pointer2.id;\n\t},\n\n\tgetIDs( pointers:Pointer[] ):string[] {\n\t\treturn pointers\n\t\t\t.map( pointer => pointer.id )\n\t\t\t;\n\t},\n\n\tresolveAll<T extends object>( pointers:Pointer[] ):Promise<[ (T & PersistedDocument)[], Response[] ]> {\n\t\tconst promises:Promise<[ T & PersistedDocument, Response ]>[] = pointers.map( ( pointer:Pointer ) => pointer.resolve<T>() );\n\t\treturn Promise\n\t\t\t.all<[ T & PersistedDocument, Response ]>( promises )\n\t\t\t.then<[ (T & PersistedDocument)[], Response[] ]>( ( results:[ T & PersistedDocument, Response ][] ) => {\n\t\t\t\tlet resolvedPointers:(T & PersistedDocument)[] = results.map( ( result:[ T & PersistedDocument, Response ] ) => result[ 0 ] );\n\t\t\t\tlet responses:Response[] = results.map( ( result:[ T & PersistedDocument, Response ] ) => result[ 1 ] );\n\n\t\t\t\treturn [ resolvedPointers, responses ];\n\t\t\t} );\n\t},\n};\n\n"]}