{"version":3,"sources":["Registry/DocumentsRegistry.ts"],"names":[],"mappings":"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","file":"DocumentsRegistry.js","sourcesContent":["import { CarbonLDP } from \"../CarbonLDP\";\nimport { Document } from \"../Document\";\nimport { IllegalArgumentError } from \"../Errors\";\nimport { FreeResources } from \"../FreeResources\";\nimport { Response } from \"../HTTP\";\nimport {\n\tHTTPError,\n\tstatusCodeMap,\n\tUnknownError\n} from \"../HTTP/Errors\";\nimport { JSONLDParser } from \"../JSONLD\";\nimport { ErrorResponse } from \"../LDP\";\nimport {\n\tDigestedObjectSchema,\n\tObjectSchemaUtils\n} from \"../ObjectSchema\";\nimport { Pointer } from \"../Pointer\";\nimport {\n\tRDFNode,\n\tURI\n} from \"../RDF\";\nimport { Registry } from \"./Registry\";\nimport { RegistryService } from \"./RegistryService\";\n\n\nexport class DocumentsRegistry extends RegistryService<Document, CarbonLDP> {\n\n\treadonly _context:CarbonLDP | undefined;\n\n\tconstructor( context?:CarbonLDP ) {\n\t\tsuper( Document, context );\n\t}\n\n\n\tregister( id:string ):Document {\n\t\treturn this._register( { id } );\n\t}\n\n\t_register<T extends object>( base:T & { id:string } ):T & Document {\n\t\tconst document:T & Document = super._register( base );\n\t\tdocument._context = this._context;\n\n\t\treturn document;\n\t}\n\n\t_getLocalID( id:string ):string {\n\t\tif( URI.isBNodeID( id ) || URI.hasFragment( id ) )\n\t\t\treturn Registry.PROTOTYPE._getLocalID.call( this, id );\n\n\t\treturn super._getLocalID( id );\n\t}\n\n\n\t_requestURLFor( pointer:Pointer, uri?:string ):string {\n\t\tif( uri && this._context ) {\n\t\t\tconst schema:DigestedObjectSchema = this.getGeneralSchema();\n\t\t\turi = ObjectSchemaUtils.resolveURI( uri, schema );\n\t\t}\n\n\t\tconst id:string = uri ? URI.resolve( pointer.id, uri ) : pointer.id;\n\n\t\tconst localIRI:string = this._getLocalID( id );\n\t\tif( this._context )\n\t\t\treturn URI.resolve( this._context.baseURI, localIRI );\n\n\t\tif( URI.isRelative( id ) )\n\t\t\tthrow new IllegalArgumentError( `\"${ id }\" cannot be resolved.` );\n\t\treturn id;\n\t}\n\n\n\t_parseErrorResponse<T extends object>( response:Response | Error | null ):Promise<never> {\n\t\tif( ! response || response instanceof Error ) return Promise.reject( response );\n\n\t\tif( ! (response.status >= 400 && response.status < 600 && statusCodeMap.has( response.status )) )\n\t\t\treturn Promise.reject( new UnknownError( response.data, response ) );\n\n\t\tconst error:HTTPError = new (statusCodeMap.get( response.status ))( response.data, response );\n\t\tif( ! response.data ) return Promise.reject( error );\n\n\t\treturn new JSONLDParser()\n\t\t\t.parse( response.data )\n\t\t\t.then( ( freeNodes:RDFNode[] ) => {\n\t\t\t\tconst freeResources:FreeResources = this._parseFreeNodes( freeNodes );\n\t\t\t\tconst errorResponses:ErrorResponse[] = freeResources\n\t\t\t\t\t.getPointers( true )\n\t\t\t\t\t.filter( ErrorResponse.is );\n\t\t\t\tif( errorResponses.length === 0 ) return Promise.reject( new IllegalArgumentError( \"The response string does not contains a c:ErrorResponse.\" ) );\n\t\t\t\tif( errorResponses.length > 1 ) return Promise.reject( new IllegalArgumentError( \"The response string contains multiple c:ErrorResponse.\" ) );\n\n\t\t\t\tObject.assign( error, errorResponses[ 0 ] );\n\t\t\t\terror.message = ErrorResponse.getMessage( error );\n\t\t\t\treturn Promise.reject( error );\n\t\t\t}, () => {\n\t\t\t\treturn Promise.reject( error );\n\t\t\t} );\n\t}\n\n}\n"]}