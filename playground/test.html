<html>
<head></head>
<body>
	<script src="../dist/bundles/Carbon.sfx.js"></script>
	<script>
		(function() {
			var carbon = new Carbon();
			carbon.setSetting( "domain", "dev.carbonldp.com" );

			carbon.extendObjectSchema( {
				"acl": "http://www.w3.org/ns/auth/acl#",
				"api": "http://purl.org/linked-data/api/vocab#",
				"c": "http://carbonldp.com/ns/v1/platform#",
				"cs": "http://carbonldp.com/ns/v1/security#",
				"cp": "http://carbonldp.com/ns/v1/patch#",
				"cc": "http://creativecommons.org/ns#",
				"cert": "http://www.w3.org/ns/auth/cert#",
				"dbp": "http://dbpedia.org/property/",
				"dc": "http://purl.org/dc/terms/",
				"doap": "http://usefulinc.com/ns/doap#",
				"example": "http://example.org/ns#",
				"ex": "http://example.org/ns#",
				"exif": "http://www.w3.org/2003/12/exif/ns#",
				"fn": "http://www.w3.org/2005/xpath-functions#",
				"foaf": "http://xmlns.com/foaf/0.1/",
				"geo": "http://www.w3.org/2003/01/geo/wgs84_pos#",
				"geonames": "http://www.geonames.org/ontology#",
				"gr": "http://purl.org/goodrelations/v1#",
				"http": "http://www.w3.org/2006/http#",
				"ldp": "http://www.w3.org/ns/ldp#",
				"log": "http://www.w3.org/2000/10/swap/log#",
				"owl": "http://www.w3.org/2002/07/owl#",
				"rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
				"rdfs": "http://www.w3.org/2000/01/rdf-schema#",
				"rei": "http://www.w3.org/2004/06/rei#",
				"rsa": "http://www.w3.org/ns/auth/rsa#",
				"rss": "http://purl.org/rss/1.0/",
				"sd": "http://www.w3.org/ns/sparql-service-description#",
				"sfn": "http://www.w3.org/ns/sparql#",
				"sioc": "http://rdfs.org/sioc/ns#",
				"skos": "http://www.w3.org/2004/02/skos/core#",
				"swrc": "http://swrc.ontoware.org/ontology#",
				"types": "http://rdfs.org/sioc/types#",
				"vcard": "http://www.w3.org/2001/vcard-rdf/3.0#",
				"wot": "http://xmlns.com/wot/0.1/",
				"xhtml": "http://www.w3.org/1999/xhtml#",
				"xsd": "http://www.w3.org/2001/XMLSchema#"
			} );

			carbon.extendObjectSchema( {
				"stringProperty": {
					"@id": "ex:stringProperty",
					"@type": "xsd:string"
				},
				"something": {
					"@id": "ex:something",
					"@type": "xsd:string"
				}
			} );

			var appContext;
			var document;

			carbon.auth.authenticate( "admin@carbonldp.com", "hello" ).then( function() {
				return carbon.apps.get( "test-app/" );
			} ).then( function( fetchedAppContext ) {
				appContext = fetchedAppContext;

				return appContext.documents.get( "resource/" );
			} ).then( function( result ) {
				document = result[ 0 ];

				document.removeFragment( "some-slug" );
				document.removeFragment( "some-other-slug" );

				return document.save();
			} ).then( function( results ) {
				return results[ 0 ].resolve();
			} ).then( function( result ) {
				document = result[ 0 ];

				console.log( "%o", document );
			} );

//			carbon.auth.authenticate( "admin@carbonldp.com", "hello" ).then( function() {
//				return carbon.documents.executeSELECTQuery( "apps/", "SELECT ?c ?s ?p ?o WHERE { GRAPH ?c { ?s ?p ?o. FILTER ( ! isBlank( ?s ) && ! isBlank( ?o ) ) } }" );
//			} ).then( function( result ) {
//				var sparqlResults = result[ 0 ];
//				sparqlResults.bindings.forEach( function( binding ) {
//					for( var bindingName in binding ) {
//						if( ! binding.hasOwnProperty( bindingName ) ) continue;
//						if( typeof binding[ bindingName ] === "object" ) binding[ bindingName ] = binding[ bindingName ].id;
//					}
//				});
//				console.table( sparqlResults.bindings );
//			} ).catch( function( error ) {
//				console.error( error );
//			} );

//			carbon.auth.authenticate( "admin@carbonldp.com", "hello" ).then( function() {
//				return carbon.apps.get( "test-app/" );
//			} ).then( function( fetchedAppContext ) {
//				appContext = fetchedAppContext;
//
//				return appContext.documents.get( "/" );
//			} ).then( function( result ) {
//				resource = result[ 0 ];
//				return populate( resource.id );
//			} ).then( function( results ) {
//				console.log( "%o", results );
//			} );

			function populate( resourceURI ) {
				console.log( "Populating: " + resourceURI );
				var promises = [];
				while( getRandom( 10 ) !== 0 ) {
					promises.push( appContext.documents.createChild( resourceURI, Carbon.Document.factory.create() ).then( function( result ) {
						var pointer = result[ 0 ];
						console.log( "Created: " + pointer.id );
						return populate( pointer.id );
					}) );
				}

				return Promise.all( promises ).then( function() {
					console.log( "Finished populating: " + resourceURI );
				});
			}

			function getRandom( max ) {
				return Math.floor(Math.random() * max);
			}
		})();
	</script>
</body>
</html>